
> veritak-financial-platform@1.0.0 dev
> next dev -p 3000

   ‚ñ≤ Next.js 15.5.3
   - Local:        http://localhost:3000
   - Network:      http://10.0.0.54:3000
   - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1000ms
 ‚úì Compiled /api/stocks/analyze in 446ms (492 modules)
[2025-09-26T14:57:02.679Z] INFO [FallbackDataService] FMP Plan detected: starter
Metadata: {
  "rateLimit": "300/minute",
  "dailyLimit": "999999/day",
  "priority": 1,
  "tier": "paid"
}
[2025-09-26T14:57:02.680Z] INFO [FallbackDataService] Fallback Data Service initialized with 5 free sources
Metadata: {
  "sources": [
    {
      "priority": 1,
      "name": "Financial Modeling Prep",
      "rateLimit": 300,
      "dailyLimit": 999999
    },
    {
      "priority": 2,
      "name": "Polygon",
      "rateLimit": 5,
      "dailyLimit": 50000
    },
    {
      "priority": 3,
      "name": "Yahoo Finance",
      "rateLimit": 60
    },
    {
      "priority": 4,
      "name": "Alpha Vantage",
      "rateLimit": 5,
      "dailyLimit": 25
    },
    {
      "priority": 5,
      "name": "Twelve Data",
      "rateLimit": 8,
      "dailyLimit": 800
    }
  ]
}
üî¨ Starting comprehensive analysis via StockSelectionService...
[2025-09-26T14:57:02.723Z] INFO [FallbackDataService] FMP Plan detected: starter
Metadata: {
  "rateLimit": "300/minute",
  "dailyLimit": "999999/day",
  "priority": 1,
  "tier": "paid"
}
[2025-09-26T14:57:02.723Z] INFO [FallbackDataService] Fallback Data Service initialized with 5 free sources
Metadata: {
  "sources": [
    {
      "priority": 1,
      "name": "Financial Modeling Prep",
      "rateLimit": 300,
      "dailyLimit": 999999
    },
    {
      "priority": 2,
      "name": "Polygon",
      "rateLimit": 5,
      "dailyLimit": 50000
    },
    {
      "priority": 3,
      "name": "Yahoo Finance",
      "rateLimit": 60
    },
    {
      "priority": 4,
      "name": "Alpha Vantage",
      "rateLimit": 5,
      "dailyLimit": 25
    },
    {
      "priority": 5,
      "name": "Twelve Data",
      "rateLimit": 8,
      "dailyLimit": 800
    }
  ]
}
‚úÖ ESG Data Service initialized with API key
üè≠ MacroeconomicAnalysisService initialized with data source orchestration
Reddit API Enhanced initialized for multi-subreddit sentiment analysis
‚úÖ ESG Data Service initialized with API key
‚úÖ Short Interest Service initialized with Polygon API integration
‚úÖ ESG Data Service initialized with API key
‚úÖ Comprehensive StockSelectionService initialized with full analysisInputServices
üìä Executing comprehensive stock analysis: {
  mode: 'single_stock',
  symbols: [ 'AAPL' ],
  sector: undefined,
  requestId: 'admin_test_1758898622725_qumb3p794'
}
‚úÖ Redis connected successfully
‚úÖ Redis connected successfully
‚úÖ Redis connected successfully
Redis connected
üöÄ Redis ready for operations
üöÄ Redis ready for operations
üöÄ Redis ready for operations
üîß Building customized config for: composite
üìã Base config keys: [
  'id',
  'name',
  'description',
  'type',
  'enabled',
  'selectionCriteria',
  'universe',
  'weights',
  'selection',
  'risk',
  'dataFusion',
  'metadata'
]
üåå Base universe: { maxPositions: 40, marketCapMin: 500000000 }
‚úÖ Universe config built successfully: { maxPositions: 1, marketCapMin: 500000000, excludeSymbols: [] }
No data sources available in service config, using default
Using symbols from context: [AAPL]
Algorithm Composite Analysis Algorithm: Evaluating 1 stocks
üìä Using optimized batch size: 10 (FMP Starter: true)
Fetching fresh market data for AAPL...
[2025-09-26T14:57:02.730Z] DEBUG [FallbackDataService] Starting API call: getStockPrice
Metadata: {
  "timeout": 30000,
  "retries": 2
}
[2025-09-26T14:57:02.730Z] DEBUG [FallbackDataService] Optimal source selection for stock_price
Metadata: {
  "selectedSources": [
    {
      "name": "Twelve Data",
      "priority": 5,
      "rateLimit": 8,
      "currentUsage": 0
    },
    {
      "name": "Alpha Vantage",
      "priority": 4,
      "rateLimit": 5,
      "currentUsage": 0
    },
    {
      "name": "Yahoo Finance",
      "priority": 3,
      "rateLimit": 60,
      "currentUsage": 0
    }
  ],
  "totalAvailable": 5
}
[2025-09-26T14:57:02.730Z] DEBUG [FallbackDataService] Trying Twelve Data for AAPL
[2025-09-26T14:57:02.730Z] DEBUG [FallbackDataService] Starting API call: Twelve Data_getStockPrice
Metadata: {
  "timeout": 15000,
  "retries": 1
}
üåê TwelveData API URL: https://api.twelvedata.com/quote?symbol=AAPL&apikey=d9cb9bb2d6ef402a8311be460f983faa
[2025-09-26T14:57:02.733Z] DEBUG [FallbackDataService] Starting API call: getMarketData
Metadata: {
  "timeout": 20000,
  "retries": 1
}
[2025-09-26T14:57:02.733Z] DEBUG [FallbackDataService] Optimal source selection for market_data
Metadata: {
  "selectedSources": [
    {
      "name": "Twelve Data",
      "priority": 5,
      "rateLimit": 8,
      "currentUsage": 0
    },
    {
      "name": "Alpha Vantage",
      "priority": 4,
      "rateLimit": 5,
      "currentUsage": 0
    },
    {
      "name": "Yahoo Finance",
      "priority": 3,
      "rateLimit": 60,
      "currentUsage": 0
    }
  ],
  "totalAvailable": 5
}
[2025-09-26T14:57:02.733Z] DEBUG [FallbackDataService] Starting API call: Twelve Data_getMarketData
Metadata: {
  "timeout": 15000,
  "retries": 1
}
üåê TwelveData API URL: https://api.twelvedata.com/quote?symbol=AAPL&apikey=d9cb9bb2d6ef402a8311be460f983faa
[2025-09-26T14:57:02.734Z] DEBUG [FallbackDataService] Starting API call: getCompanyInfo
Metadata: {
  "timeout": 20000,
  "retries": 1
}
[2025-09-26T14:57:02.734Z] DEBUG [FallbackDataService] Optimal source selection for company_info
Metadata: {
  "selectedSources": [
    {
      "name": "Twelve Data",
      "priority": 5,
      "rateLimit": 8,
      "currentUsage": 0
    },
    {
      "name": "Alpha Vantage",
      "priority": 4,
      "rateLimit": 5,
      "currentUsage": 0
    },
    {
      "name": "Yahoo Finance",
      "priority": 3,
      "rateLimit": 60,
      "currentUsage": 0
    }
  ],
  "totalAvailable": 5
}
[2025-09-26T14:57:02.734Z] DEBUG [FallbackDataService] Starting API call: Twelve Data_getCompanyInfo
Metadata: {
  "timeout": 15000,
  "retries": 1
}
üåê TwelveData API URL: https://api.twelvedata.com/profile?symbol=AAPL&apikey=d9cb9bb2d6ef402a8311be460f983faa
[2025-09-26T14:57:02.954Z] DEBUG [FallbackDataService] Performance: Twelve Data_getMarketData completed in 221ms
Metadata: {
  "type": "performance",
  "operation": "Twelve Data_getMarketData",
  "duration": 221,
  "attempts": 1
}
[2025-09-26T14:57:02.954Z] DEBUG [FallbackDataService] Performance: getMarketData completed in 221ms
Metadata: {
  "type": "performance",
  "operation": "getMarketData",
  "duration": 221,
  "attempts": 1
}
[2025-09-26T14:57:02.955Z] DEBUG [FallbackDataService] Performance: Twelve Data_getCompanyInfo completed in 221ms
Metadata: {
  "type": "performance",
  "operation": "Twelve Data_getCompanyInfo",
  "duration": 221,
  "attempts": 1
}
[2025-09-26T14:57:02.955Z] DEBUG [FallbackDataService] Performance: getCompanyInfo completed in 221ms
Metadata: {
  "type": "performance",
  "operation": "getCompanyInfo",
  "duration": 221,
  "attempts": 1
}
[2025-09-26T14:57:03.498Z] DEBUG [FallbackDataService] Performance: Twelve Data_getStockPrice completed in 768ms
Metadata: {
  "type": "performance",
  "operation": "Twelve Data_getStockPrice",
  "duration": 768,
  "attempts": 1
}
[2025-09-26T14:57:03.498Z] DEBUG [FallbackDataService] Performance: Twelve Data_getStockPrice completed in 768ms
Metadata: {
  "type": "performance",
  "operation": "Twelve Data_getStockPrice",
  "duration": 768,
  "symbol": "AAPL",
  "source": "Twelve Data"
}
[2025-09-26T14:57:03.498Z] DEBUG [FallbackDataService] Performance: getStockPrice completed in 768ms
Metadata: {
  "type": "performance",
  "operation": "getStockPrice",
  "duration": 768,
  "attempts": 1
}
Got stock data for AAPL: price=255.28, volume=954298
‚úÖ Market data fetched for 1/1 symbols (100.0% success rate)
Fetched market data for 1 stocks
[2025-09-26T14:57:03.499Z] DEBUG [FallbackDataService] Starting API call: getFundamentalRatios
Metadata: {
  "timeout": 30000,
  "retries": 2
}
[2025-09-26T14:57:03.499Z] DEBUG [FallbackDataService] Starting API call: Financial Modeling Prep_getFundamentalRatios
Metadata: {
  "timeout": 20000,
  "retries": 1
}
[2025-09-26T14:57:03.499Z] DEBUG [api.financial-modeling-prep] Starting API call: getFundamentalRatios
Metadata: {
  "timeout": 15000,
  "retries": 2
}
[2025-09-26T14:57:03.501Z] DEBUG [FallbackDataService] Starting API call: Yahoo Finance_getFundamentalRatios
Metadata: {
  "timeout": 20000,
  "retries": 1
}
üìä Fetching fundamental data from yfinance for AAPL
[2025-09-26T14:57:03.988Z] WARN [api.financial-modeling-prep] Invalid ratios response structure
Metadata: {
  "errors": [
    "Invalid response data structure"
  ],
  "symbol": "AAPL"
}
[2025-09-26T14:57:03.988Z] WARN [api.financial-modeling-prep] Invalid metrics response structure
Metadata: {
  "errors": [
    "Invalid response data structure"
  ],
  "symbol": "AAPL"
}
[2025-09-26T14:57:03.988Z] WARN [api.financial-modeling-prep] Invalid pbRatio value for AAPL
Metadata: {
  "fieldName": "pbRatio",
  "value": 57.766511022634056,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T14:57:03.988Z] WARN [api.financial-modeling-prep] Invalid priceToSales value for AAPL
Metadata: {
  "fieldName": "priceToSales",
  "value": 9.267231119730805,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T14:57:03.988Z] WARN [api.financial-modeling-prep] Invalid currentRatio value for AAPL
Metadata: {
  "fieldName": "currentRatio",
  "value": 0.8679917800453515,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T14:57:03.988Z] WARN [api.financial-modeling-prep] Invalid quickRatio value for AAPL
Metadata: {
  "fieldName": "quickRatio",
  "value": 0.8260062358276644,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T14:57:03.988Z] WARN [api.financial-modeling-prep] Invalid grossProfitMargin value for AAPL
Metadata: {
  "fieldName": "grossProfitMargin",
  "value": 0.4667825022942796,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T14:57:03.988Z] WARN [api.financial-modeling-prep] Invalid operatingMargin value for AAPL
Metadata: {
  "fieldName": "operatingMargin",
  "value": 0.31866381156316914,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T14:57:03.988Z] WARN [api.financial-modeling-prep] Invalid netProfitMargin value for AAPL
Metadata: {
  "fieldName": "netProfitMargin",
  "value": 0.24296115019883757,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T14:57:03.988Z] WARN [api.financial-modeling-prep] Invalid dividendYield value for AAPL
Metadata: {
  "fieldName": "dividendYield",
  "value": 0.00399734,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T14:57:03.988Z] DEBUG [api.financial-modeling-prep] Performance: getFundamentalRatios completed in 489ms
Metadata: {
  "type": "performance",
  "operation": "getFundamentalRatios",
  "duration": 489,
  "attempts": 1
}
[2025-09-26T14:57:03.988Z] DEBUG [FallbackDataService] Performance: Financial Modeling Prep_getFundamentalRatios completed in 489ms
Metadata: {
  "type": "performance",
  "operation": "Financial Modeling Prep_getFundamentalRatios",
  "duration": 489,
  "attempts": 1
}
[2025-09-26T14:57:03.988Z] INFO [FallbackDataService] Fundamental ratios from Financial Modeling Prep for AAPL
Metadata: {
  "peRatio": "N/A",
  "pbRatio": "N/A",
  "source": "Financial Modeling Prep"
}
‚úÖ yfinance fundamental data retrieved for AAPL: { peRatio: '38.67', roe: '149.81%', debtToEquity: '154.49' }
[2025-09-26T14:57:04.376Z] DEBUG [FallbackDataService] Performance: Yahoo Finance_getFundamentalRatios completed in 875ms
Metadata: {
  "type": "performance",
  "operation": "Yahoo Finance_getFundamentalRatios",
  "duration": 875,
  "attempts": 1
}
[2025-09-26T14:57:04.376Z] INFO [FallbackDataService] Fundamental ratios from Yahoo Finance for AAPL
Metadata: {
  "peRatio": "38.67",
  "pbRatio": "57.60",
  "source": "Yahoo Finance"
}
[2025-09-26T14:57:04.376Z] DEBUG [FallbackDataService] Performance: getFundamentalRatios completed in 877ms
Metadata: {
  "type": "performance",
  "operation": "getFundamentalRatios",
  "duration": 877,
  "attempts": 1
}
[2025-09-26T14:57:04.376Z] DEBUG [FMPCacheManager] Cache entry set for fmp:fundamental_ratios:AAPL
Metadata: {
  "dataType": "fundamental_ratios",
  "ttl": "3600s",
  "compressed": false,
  "size": "0.1KB"
}
[2025-09-26T14:57:04.376Z] DEBUG [FallbackDataService] Cached fundamental ratios for AAPL
[2025-09-26T14:57:04.377Z] DEBUG [FallbackDataService] Starting API call: getCompanyInfo
Metadata: {
  "timeout": 20000,
  "retries": 1
}
[2025-09-26T14:57:04.377Z] DEBUG [FallbackDataService] Optimal source selection for company_info
Metadata: {
  "selectedSources": [
    {
      "name": "Twelve Data",
      "priority": 5,
      "rateLimit": 8,
      "currentUsage": 3
    },
    {
      "name": "Alpha Vantage",
      "priority": 4,
      "rateLimit": 5,
      "currentUsage": 0
    },
    {
      "name": "Yahoo Finance",
      "priority": 3,
      "rateLimit": 60,
      "currentUsage": 1
    }
  ],
  "totalAvailable": 5
}
[2025-09-26T14:57:04.377Z] DEBUG [FallbackDataService] Starting API call: Twelve Data_getCompanyInfo
Metadata: {
  "timeout": 15000,
  "retries": 1
}
üåê TwelveData API URL: https://api.twelvedata.com/profile?symbol=AAPL&apikey=d9cb9bb2d6ef402a8311be460f983faa
[2025-09-26T14:57:04.555Z] DEBUG [FallbackDataService] Performance: Twelve Data_getCompanyInfo completed in 178ms
Metadata: {
  "type": "performance",
  "operation": "Twelve Data_getCompanyInfo",
  "duration": 178,
  "attempts": 1
}
[2025-09-26T14:57:04.555Z] DEBUG [FallbackDataService] Performance: getCompanyInfo completed in 178ms
Metadata: {
  "type": "performance",
  "operation": "getCompanyInfo",
  "duration": 178,
  "attempts": 1
}
Fetched fundamental data for 1 stocks
Processing symbol AAPL, marketData keys: [AAPL]
Calculating score for AAPL with market data: { price: 255.28, volume: 954298 }
Starting score calculation for AAPL, weights count: 10
üéØ COMPOSITE ALGORITHM DETECTED - Using enhanced composite factor calculation
üì∞ Pre-fetching sentiment data for AAPL...
üì∞ Sentiment pre-fetched for AAPL: 0.4992915555555555
üìä Pre-fetching VWAP analysis for AAPL...
Polygon API: Fetching prev data for AAPL
üìä VWAP pre-fetched for AAPL: success
üåç Pre-fetching macroeconomic context for AAPL (Technology)...
üîç Fetching fresh macroeconomic context with parallel processing...
üîç Getting latest observation for PET.RWTC.D...
üåê EIA API URL: https://api.eia.gov/v2/seriesid/PET.RWTC.D?api_key=qAU83CqOXOVXduLuhimcS5d09lFWmMW6vU67bcFJ&length=1
üîç Getting latest observation for PET.RBRTE.D...
üåê EIA API URL: https://api.eia.gov/v2/seriesid/PET.RBRTE.D?api_key=qAU83CqOXOVXduLuhimcS5d09lFWmMW6vU67bcFJ&length=1
üîç Getting latest observation for NG.RNGWHHD.D...
üåê EIA API URL: https://api.eia.gov/v2/seriesid/NG.RNGWHHD.D?api_key=qAU83CqOXOVXduLuhimcS5d09lFWmMW6vU67bcFJ&length=1
üîç Getting latest observation for PET.EMM_EPMR_PTE_NUS_DPG.W...
üåê EIA API URL: https://api.eia.gov/v2/seriesid/PET.EMM_EPMR_PTE_NUS_DPG.W?api_key=qAU83CqOXOVXduLuhimcS5d09lFWmMW6vU67bcFJ&length=1
üìä Returning cached economic context
üìä Returning cached inflation trend analysis
üìä Returning cached monetary policy context
üìä Returning cached economic cycle position
Unemployment trend analysis completed in 325ms
üìä Response for PET.RBRTE.D: {
  success: true,
  hasData: true,
  hasResponse: true,
  dataLength: 1,
  error: undefined
}
‚úÖ Found observation for PET.RBRTE.D: {
  period: '2025-09-22',
  duoarea: 'ZEU',
  'area-name': 'NA',
  product: 'EPCBRENT',
  'product-name': 'UK Brent Crude Oil',
  process: 'PF4',
  'process-name': 'Spot Price FOB',
  series: 'RBRTE',
  'series-description': 'Europe Brent Spot Price FOB (Dollars per Barrel)',
  value: 66.87,
  units: '$/BBL'
}
üìä Response for PET.RWTC.D: {
  success: true,
  hasData: true,
  hasResponse: true,
  dataLength: 1,
  error: undefined
}
‚úÖ Found observation for PET.RWTC.D: {
  period: '2025-09-22',
  duoarea: 'YCUOK',
  'area-name': 'NA',
  product: 'EPCWTI',
  'product-name': 'WTI Crude Oil',
  process: 'PF4',
  'process-name': 'Spot Price FOB',
  series: 'RWTC',
  'series-description': 'Cushing, OK WTI Spot Price FOB (Dollars per Barrel)',
  value: 62.99,
  units: '$/BBL'
}
üìä Response for NG.RNGWHHD.D: {
  success: true,
  hasData: true,
  hasResponse: true,
  dataLength: 1,
  error: undefined
}
‚úÖ Found observation for NG.RNGWHHD.D: {
  period: '2025-09-22',
  duoarea: 'RGC',
  'area-name': 'NA',
  product: 'EPG0',
  'product-name': 'Natural Gas',
  process: 'PS0',
  'process-name': 'Spot Price',
  series: 'RNGWHHD',
  'series-description': 'Henry Hub Natural Gas Spot Price (Dollars per Million Btu)',
  value: 2.9,
  units: '$/MMBTU'
}
Payroll momentum analysis completed in 132ms
Employment strength scoring completed in 669ms
üìä Response for PET.EMM_EPMR_PTE_NUS_DPG.W: {
  success: true,
  hasData: true,
  hasResponse: true,
  dataLength: 1,
  error: undefined
}
‚úÖ Found observation for PET.EMM_EPMR_PTE_NUS_DPG.W: {
  period: '2025-09-22',
  duoarea: 'NUS',
  'area-name': 'U.S.',
  product: 'EPMR',
  'product-name': 'Regular Gasoline',
  process: 'PTE',
  'process-name': 'Retail Sales',
  series: 'EMM_EPMR_PTE_NUS_DPG',
  'series-description': 'U.S. Regular All Formulations Retail Gasoline Prices (Dollars per Gallon)',
  value: 3.173,
  units: '$/GAL'
}
‚ö° Quick commodity snapshot in 1061ms
‚úÖ Macro context generated in 1067ms with 100.0% efficiency
‚ö†Ô∏è Performance target missed: 1067ms > 800ms target
üåç Macro context pre-fetched for AAPL: success
üå± Pre-fetching ESG data for AAPL (Technology)...
‚úÖ ESG Data Service initialized with API key
üå± Analyzing ESG impact for AAPL (Technology)
üå± ESG pre-fetched for AAPL: 0.810
üìä Pre-fetching short interest data for AAPL (Technology)...
‚úÖ Short Interest Service initialized with Polygon API integration
üìä Analyzing short interest impact for AAPL (Technology)
üìä Short interest data for AAPL retrieved from cache
üìä Short interest pre-fetched for AAPL: score 0.499, impact neutral
üïí Pre-fetching extended market data for AAPL...
‚úÖ Redis connected successfully
üöÄ Redis ready for operations
Polygon API: Fetching prev data for AAPL
Polygon API: Fetching prev data for AAPL
üïí Extended market data pre-fetched for AAPL: extended hours data market-hours, liquidity N/A
Starting calculation of factor composite for AAPL
üéØ Calculating MAIN composite score for AAPL with ALL required components
üîç Attempting to calculate technical overall score for AAPL
Fetching 250 days of historical data for AAPL
üåê TwelveData API URL: https://api.twelvedata.com/time_series?symbol=AAPL&interval=1day&outputsize=100&apikey=d9cb9bb2d6ef402a8311be460f983faa
TwelveData: Retrieved 100 OHLC records for AAPL
Successfully fetched 100 historical price points for AAPL
‚úÖ Using 100 data points for technical analysis of AAPL
üìä Technical analysis result for AAPL: 56/100
Technical Analysis: 0.560 (weight: 38.1%) ‚ö°
Calculating quality composite for data: {
  roe: undefined,
  debtToEquity: undefined,
  currentRatio: undefined,
  operatingMargin: undefined,
  netProfitMargin: undefined,
  grossProfitMargin: undefined
}
Quality factor ROE: No valid data (null)
Quality factor Debt/Equity: No valid data (null)
Quality factor Current Ratio: No valid data (null)
Quality factor Operating Margin: No valid data (null)
Quality factor Gross Profit Margin: No valid data (null)
Insufficient quality factors: only 0 valid factors found
Fundamental Analysis: No data (fallback to neutral 0.5)
üåç Calculating macroeconomic composite from pre-fetched data...
üåç Macroeconomic composite score: 1.000 (confidence: 1)
üåç Macroeconomic Analysis: 1.000 (weight: 19.0%) - INTEGRATED!
üì∞ Sentiment Analysis: 0.499 (weight: 9.5%) - INTEGRATED!
Extended Market Data service not available
üíπ Extended Market Data: 0.500 (weight: 4.8%) - INTEGRATED!
Short Interest service not available
üìä Short Interest Analysis: 0.500 (weight: 2.4%) - INTEGRATED!
üå± ESG Analysis: 0.810 (weight: 2.4%) - INTEGRATED!
üéØ Main composite calculation for AAPL:
   Final weighted score: 0.6252
   Weight Allocation: Technical(38.1%) + Fundamental(23.8%) + Macroeconomic(19.0%) + Sentiment(9.5%) + Extended Market(4.8%) + Short Interest(2.4%) + ESG(2.4%) = 100.0%
   ‚úÖ WEIGHT VERIFICATION: Total weights = 1.000 (target: 1.000)
   Contributing factors: [technicalAnalysis, technical_overall_score, macroeconomicAnalysis, macroeconomic_composite, sentimentAnalysis, sentiment_composite, extendedMarketData, extended_market_composite, shortInterestAnalysis, short_interest_composite, esgAnalysis, esg_composite]
‚úÖ Factor composite for AAPL: 0.6252 (calculated in 162ms)
üéØ Enhanced composite score for AAPL: 0.6252326977777778
‚úÖ Technical overall score for AAPL: 0.560 - TRACKED
Starting calculation of factor quality_composite for AAPL
Calculating quality composite for data: {
  roe: undefined,
  debtToEquity: undefined,
  currentRatio: undefined,
  operatingMargin: undefined,
  netProfitMargin: undefined,
  grossProfitMargin: undefined
}
Quality factor ROE: No valid data (null)
Quality factor Debt/Equity: No valid data (null)
Quality factor Current Ratio: No valid data (null)
Quality factor Operating Margin: No valid data (null)
Quality factor Gross Profit Margin: No valid data (null)
Insufficient quality factors: only 0 valid factors found
‚ö†Ô∏è Factor quality_composite for AAPL: returned null/NaN (0ms)
Starting calculation of factor momentum_composite for AAPL
Calculating momentum composite for AAPL
Fetching 127 days of historical data for AAPL
üåê TwelveData API URL: https://api.twelvedata.com/time_series?symbol=AAPL&interval=1day&outputsize=100&apikey=d9cb9bb2d6ef402a8311be460f983faa
TwelveData: Retrieved 100 OHLC records for AAPL
Successfully fetched 100 historical price points for AAPL
Momentum factor 1-month momentum: 0.631 (weight: 0.25)
Momentum factor 3-month momentum: 0.794 (weight: 0.3)
Momentum factor 6-month momentum: No data available
Momentum factor RSI: No data available
Momentum factor MACD: No data available
Momentum composite score for AAPL: 0.720 (based on 0.55 total weight)
‚úÖ Factor momentum_composite for AAPL: 0.7199 (calculated in 203ms)
Starting calculation of factor value_composite for AAPL
Calculating value composite for data: {
  peRatio: undefined,
  pbRatio: undefined,
  priceToSales: undefined,
  evEbitda: undefined,
  marketCap: 0
}
Value factor P/E Ratio: No valid data (null)
Value factor P/B Ratio: No valid data (null)
Value factor P/S Ratio: No valid data (null)
Value factor EV/EBITDA: No valid data (null)
Insufficient value factors: only 0 valid factors found
‚ö†Ô∏è Factor value_composite for AAPL: returned null/NaN (0ms)
Starting calculation of factor volatility_30d for AAPL
Calculating 30-day volatility for AAPL
Calculated 29 daily returns for AAPL
AAPL volatility stats: {
  periods: 29,
  dailyVol: '0.0160',
  annualizedVol: '0.2539',
  meanReturn: '0.0035'
}
AAPL volatility score: 0.746 (lower volatility = higher score)
‚úÖ Factor volatility_30d for AAPL: 0.7461 (calculated in 1ms)
‚úÖ Sentiment score for AAPL: 0.499 - TRACKED
Starting calculation of factor vwap_deviation_score for AAPL
üìä Calculating VWAP deviation score from pre-fetched data...
‚úÖ Factor vwap_deviation_score for AAPL: 0.3000 (calculated in 0ms)
‚úÖ VWAP deviation score for AAPL: 0.300 - TRACKED
Starting calculation of factor vwap_trading_signals for AAPL
üìä Calculating VWAP trading signals from pre-fetched data...
üìä VWAP trading signal: above with weak strength = 0.560
‚úÖ Factor vwap_trading_signals for AAPL: 0.5600 (calculated in 0ms)
‚úÖ VWAP trading signals for AAPL: 0.560 - TRACKED
Starting calculation of factor vwap_trend_analysis for AAPL
üìä Calculating VWAP trend score with historical analysis...
üìä No VWAP trend insights available for AAPL - using fallback
üìä Calculating VWAP trading signals from pre-fetched data...
üìä VWAP trading signal: above with weak strength = 0.560
‚úÖ Factor vwap_trend_analysis for AAPL: 0.5600 (calculated in 110ms)
‚úÖ VWAP trend analysis for AAPL: 0.560 - TRACKED
Starting calculation of factor macroeconomic_sector_impact for AAPL
üåç Calculating macroeconomic sector impact from pre-fetched data...
üåç Macro sector impact for Technology: positive = 0.900
‚úÖ Factor macroeconomic_sector_impact for AAPL: 0.9000 (calculated in 1ms)
‚úÖ Macro sector impact for AAPL: 0.900 - TRACKED
Starting calculation of factor macroeconomic_composite for AAPL
üåç Calculating macroeconomic composite from pre-fetched data...
üåç Macroeconomic composite score: 1.000 (confidence: 1)
‚úÖ Factor macroeconomic_composite for AAPL: 1.0000 (calculated in 0ms)
‚úÖ Macroeconomic composite for AAPL: 1.000 - TRACKED
Successfully calculated score for AAPL: 0.6252326977777778
Calculated scores for 1 stocks
Selected 1 stocks after applying criteria
üîç Getting stock price for AAPL using smart fallback chain...
[2025-09-26T14:57:06.549Z] DEBUG [FallbackDataService] Starting API call: getFundamentalRatios
Metadata: {
  "timeout": 30000,
  "retries": 2
}
[2025-09-26T14:57:06.549Z] DEBUG [FallbackDataService] Starting API call: Financial Modeling Prep_getFundamentalRatios
Metadata: {
  "timeout": 20000,
  "retries": 1
}
[2025-09-26T14:57:06.549Z] DEBUG [api.financial-modeling-prep] Starting API call: getFundamentalRatios
Metadata: {
  "timeout": 15000,
  "retries": 2
}
[2025-09-26T14:57:06.550Z] DEBUG [FallbackDataService] Starting API call: Yahoo Finance_getFundamentalRatios
Metadata: {
  "timeout": 20000,
  "retries": 1
}
üìä Fetching fundamental data from yfinance for AAPL
[2025-09-26T14:57:06.555Z] DEBUG [FallbackDataService] Starting API call: getStockPrice
Metadata: {
  "timeout": 30000,
  "retries": 2
}
[2025-09-26T14:57:06.555Z] DEBUG [FallbackDataService] Optimal source selection for stock_price
Metadata: {
  "selectedSources": [
    {
      "name": "Twelve Data",
      "priority": 5,
      "rateLimit": 8,
      "currentUsage": 0
    },
    {
      "name": "Alpha Vantage",
      "priority": 4,
      "rateLimit": 5,
      "currentUsage": 0
    },
    {
      "name": "Yahoo Finance",
      "priority": 3,
      "rateLimit": 60,
      "currentUsage": 0
    }
  ],
  "totalAvailable": 5
}
[2025-09-26T14:57:06.555Z] DEBUG [FallbackDataService] Trying Twelve Data for AAPL
[2025-09-26T14:57:06.556Z] DEBUG [FallbackDataService] Starting API call: Twelve Data_getStockPrice
Metadata: {
  "timeout": 15000,
  "retries": 1
}
üåê TwelveData API URL: https://api.twelvedata.com/quote?symbol=AAPL&apikey=d9cb9bb2d6ef402a8311be460f983faa
[2025-09-26T14:57:06.600Z] WARN [api.financial-modeling-prep] Invalid ratios response structure
Metadata: {
  "errors": [
    "Invalid response data structure"
  ],
  "symbol": "AAPL"
}
[2025-09-26T14:57:06.600Z] WARN [api.financial-modeling-prep] Invalid metrics response structure
Metadata: {
  "errors": [
    "Invalid response data structure"
  ],
  "symbol": "AAPL"
}
[2025-09-26T14:57:06.600Z] WARN [api.financial-modeling-prep] Invalid pbRatio value for AAPL
Metadata: {
  "fieldName": "pbRatio",
  "value": 57.77744538984961,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T14:57:06.600Z] WARN [api.financial-modeling-prep] Invalid priceToSales value for AAPL
Metadata: {
  "fieldName": "priceToSales",
  "value": 9.268985272895685,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T14:57:06.600Z] WARN [api.financial-modeling-prep] Invalid currentRatio value for AAPL
Metadata: {
  "fieldName": "currentRatio",
  "value": 0.8679917800453515,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T14:57:06.600Z] WARN [api.financial-modeling-prep] Invalid quickRatio value for AAPL
Metadata: {
  "fieldName": "quickRatio",
  "value": 0.8260062358276644,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T14:57:06.600Z] WARN [api.financial-modeling-prep] Invalid grossProfitMargin value for AAPL
Metadata: {
  "fieldName": "grossProfitMargin",
  "value": 0.4667825022942796,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T14:57:06.600Z] WARN [api.financial-modeling-prep] Invalid operatingMargin value for AAPL
Metadata: {
  "fieldName": "operatingMargin",
  "value": 0.31866381156316914,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T14:57:06.600Z] WARN [api.financial-modeling-prep] Invalid netProfitMargin value for AAPL
Metadata: {
  "fieldName": "netProfitMargin",
  "value": 0.24296115019883757,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T14:57:06.600Z] WARN [api.financial-modeling-prep] Invalid dividendYield value for AAPL
Metadata: {
  "fieldName": "dividendYield",
  "value": 0.00399658,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T14:57:06.600Z] DEBUG [api.financial-modeling-prep] Performance: getFundamentalRatios completed in 51ms
Metadata: {
  "type": "performance",
  "operation": "getFundamentalRatios",
  "duration": 51,
  "attempts": 1
}
[2025-09-26T14:57:06.600Z] DEBUG [FallbackDataService] Performance: Financial Modeling Prep_getFundamentalRatios completed in 51ms
Metadata: {
  "type": "performance",
  "operation": "Financial Modeling Prep_getFundamentalRatios",
  "duration": 51,
  "attempts": 1
}
[2025-09-26T14:57:06.601Z] INFO [FallbackDataService] Fundamental ratios from Financial Modeling Prep for AAPL
Metadata: {
  "peRatio": "N/A",
  "pbRatio": "N/A",
  "source": "Financial Modeling Prep"
}
[2025-09-26T14:57:06.733Z] DEBUG [FallbackDataService] Performance: Twelve Data_getStockPrice completed in 177ms
Metadata: {
  "type": "performance",
  "operation": "Twelve Data_getStockPrice",
  "duration": 177,
  "attempts": 1
}
[2025-09-26T14:57:06.733Z] DEBUG [FallbackDataService] Performance: Twelve Data_getStockPrice completed in 177ms
Metadata: {
  "type": "performance",
  "operation": "Twelve Data_getStockPrice",
  "duration": 177,
  "symbol": "AAPL",
  "source": "Twelve Data"
}
[2025-09-26T14:57:06.734Z] DEBUG [FallbackDataService] Performance: getStockPrice completed in 179ms
Metadata: {
  "type": "performance",
  "operation": "getStockPrice",
  "duration": 179,
  "attempts": 1
}
‚úÖ Got AAPL price: $255.28 from twelve_data
[2025-09-26T14:57:06.753Z] INFO [api.financial-modeling-prep] Generated synthetic analyst ratings for AAPL from price targets
Metadata: {
  "consensus": "Sell",
  "totalAnalysts": 22,
  "sentimentScore": 2
}
üìä Analyst ratings from Financial Modeling Prep for AAPL: Sell (22 analysts)
‚úÖ yfinance fundamental data retrieved for AAPL: { peRatio: '38.67', roe: '149.81%', debtToEquity: '154.49' }
[2025-09-26T14:57:07.310Z] DEBUG [FallbackDataService] Performance: Yahoo Finance_getFundamentalRatios completed in 760ms
Metadata: {
  "type": "performance",
  "operation": "Yahoo Finance_getFundamentalRatios",
  "duration": 760,
  "attempts": 1
}
[2025-09-26T14:57:07.310Z] INFO [FallbackDataService] Fundamental ratios from Yahoo Finance for AAPL
Metadata: {
  "peRatio": "38.67",
  "pbRatio": "57.60",
  "source": "Yahoo Finance"
}
[2025-09-26T14:57:07.310Z] DEBUG [FallbackDataService] Performance: getFundamentalRatios completed in 761ms
Metadata: {
  "type": "performance",
  "operation": "getFundamentalRatios",
  "duration": 761,
  "attempts": 1
}
[2025-09-26T14:57:07.310Z] DEBUG [FMPCacheManager] Cache entry set for fmp:fundamental_ratios:AAPL
Metadata: {
  "dataType": "fundamental_ratios",
  "ttl": "3600s",
  "compressed": false,
  "size": "0.1KB"
}
[2025-09-26T14:57:07.310Z] DEBUG [FallbackDataService] Cached fundamental ratios for AAPL
üéØ Price targets from Financial Modeling Prep for AAPL: $241.26 (-5.5% upside)
Enhanced factors for utilization: [macroeconomic_composite, fundamentalData, fundamentals, macroeconomic_sector_impact, volatility_30d, technicalAnalysis, technical]
Primary factors extracted for AAPL: [
  'macroeconomic_composite',
  'fundamentalData',
  'fundamentals',
  'macroeconomic_sector_impact',
  'volatility_30d',
  'technicalAnalysis',
  'technical'
]
üìä Returning cached macro context (1ms)
üì∞ Analyzing sentiment impact for AAPL (Technology)
üå± Analyzing ESG impact for AAPL (Technology)
üìä Analyzing short interest impact for AAPL (Technology)
üìä Short interest data for AAPL retrieved from cache
üîç Service utilization for technicalAnalysis: 1/1 = 100%
üîç Service utilization for fundamentals: 1/1 = 100%
üîç Service utilization for macroeconomicAnalysis: 1/1 = 100%
üîç Service utilization for sentimentAnalysis: 1/1 = 100%
üîç Service utilization for vwapAnalysis: 1/1 = 100%
üîç Service utilization for esgAnalysis: 0/1 = 0%
‚ö†Ô∏è  Debugging 0% utilization for esgAnalysis:
  Stock 1 (AAPL): 10 factors: []
üîç Service utilization for shortInterestAnalysis: 0/1 = 0%
‚ö†Ô∏è  Debugging 0% utilization for shortInterestAnalysis:
  Stock 1 (AAPL): 10 factors: []
Actual cache hit rate: 0/0 = 0.0%
‚úÖ Comprehensive analysis completed in 5112ms { success: true, topSelections: 1, analysisInputServices: 10 }
 POST /api/stocks/analyze 200 in 5758ms
üî¨ Starting comprehensive analysis via StockSelectionService...
üìä Executing comprehensive stock analysis: {
  mode: 'single_stock',
  symbols: [ 'AAPL' ],
  sector: undefined,
  requestId: 'admin_test_1758898651563_n3lpp97iu'
}
üîç Service utilization for technicalAnalysis: 1/1 = 100%
üîç Service utilization for fundamentals: 1/1 = 100%
üîç Service utilization for macroeconomicAnalysis: 1/1 = 100%
üîç Service utilization for sentimentAnalysis: 1/1 = 100%
üîç Service utilization for vwapAnalysis: 1/1 = 100%
üîç Service utilization for esgAnalysis: 0/1 = 0%
‚ö†Ô∏è  Debugging 0% utilization for esgAnalysis:
  Stock 1 (AAPL): 10 factors: []
üîç Service utilization for shortInterestAnalysis: 0/1 = 0%
‚ö†Ô∏è  Debugging 0% utilization for shortInterestAnalysis:
  Stock 1 (AAPL): 10 factors: []
Actual cache hit rate: 0/0 = 0.0%
‚úÖ Comprehensive analysis completed in 1ms { success: true, topSelections: 1, analysisInputServices: 10 }
 POST /api/stocks/analyze 200 in 10ms
üî¨ Starting comprehensive analysis via StockSelectionService...
üìä Executing comprehensive stock analysis: {
  mode: 'single_stock',
  symbols: [ 'AAPL' ],
  sector: undefined,
  requestId: 'admin_test_1758898655678_o1r67a03u'
}
üîç Service utilization for technicalAnalysis: 1/1 = 100%
üîç Service utilization for fundamentals: 1/1 = 100%
üîç Service utilization for macroeconomicAnalysis: 1/1 = 100%
üîç Service utilization for sentimentAnalysis: 1/1 = 100%
üîç Service utilization for vwapAnalysis: 1/1 = 100%
üîç Service utilization for esgAnalysis: 0/1 = 0%
‚ö†Ô∏è  Debugging 0% utilization for esgAnalysis:
  Stock 1 (AAPL): 10 factors: []
üîç Service utilization for shortInterestAnalysis: 0/1 = 0%
‚ö†Ô∏è  Debugging 0% utilization for shortInterestAnalysis:
  Stock 1 (AAPL): 10 factors: []
Actual cache hit rate: 0/0 = 0.0%
‚úÖ Comprehensive analysis completed in 0ms { success: true, topSelections: 1, analysisInputServices: 10 }
 POST /api/stocks/analyze 200 in 8ms
üî¨ Starting comprehensive analysis via StockSelectionService...
üìä Executing comprehensive stock analysis: {
  mode: 'single_stock',
  symbols: [ 'AAPL' ],
  sector: undefined,
  requestId: 'admin_test_1758898659919_7nxi6iel4'
}
üîç Service utilization for technicalAnalysis: 1/1 = 100%
üîç Service utilization for fundamentals: 1/1 = 100%
üîç Service utilization for macroeconomicAnalysis: 1/1 = 100%
üîç Service utilization for sentimentAnalysis: 1/1 = 100%
üîç Service utilization for vwapAnalysis: 1/1 = 100%
üîç Service utilization for esgAnalysis: 0/1 = 0%
‚ö†Ô∏è  Debugging 0% utilization for esgAnalysis:
  Stock 1 (AAPL): 10 factors: []
üîç Service utilization for shortInterestAnalysis: 0/1 = 0%
‚ö†Ô∏è  Debugging 0% utilization for shortInterestAnalysis:
  Stock 1 (AAPL): 10 factors: []
Actual cache hit rate: 0/0 = 0.0%
‚úÖ Comprehensive analysis completed in 0ms { success: true, topSelections: 1, analysisInputServices: 10 }
 POST /api/stocks/analyze 200 in 8ms
üî¨ Starting comprehensive analysis via StockSelectionService...
üìä Executing comprehensive stock analysis: {
  mode: 'single_stock',
  symbols: [ 'AAPL' ],
  sector: undefined,
  requestId: 'admin_test_1758898663879_i81ul9rrz'
}
üîç Service utilization for technicalAnalysis: 1/1 = 100%
üîç Service utilization for fundamentals: 1/1 = 100%
üîç Service utilization for macroeconomicAnalysis: 1/1 = 100%
üîç Service utilization for sentimentAnalysis: 1/1 = 100%
üîç Service utilization for vwapAnalysis: 1/1 = 100%
üîç Service utilization for esgAnalysis: 0/1 = 0%
‚ö†Ô∏è  Debugging 0% utilization for esgAnalysis:
  Stock 1 (AAPL): 10 factors: []
üîç Service utilization for shortInterestAnalysis: 0/1 = 0%
‚ö†Ô∏è  Debugging 0% utilization for shortInterestAnalysis:
  Stock 1 (AAPL): 10 factors: []
Actual cache hit rate: 0/0 = 0.0%
‚úÖ Comprehensive analysis completed in 1ms { success: true, topSelections: 1, analysisInputServices: 10 }
 POST /api/stocks/analyze 200 in 7ms
 ‚úì Compiled in 115ms (298 modules)
 ‚úì Compiled /api/market/sectors in 95ms (495 modules)
[2025-09-26T14:58:33.587Z] DEBUG [api.financial-modeling-prep] Starting API call: healthCheck
Metadata: {
  "timeout": 5000,
  "retries": 0
}
‚úÖ Redis connected successfully
üöÄ Redis ready for operations
[2025-09-26T14:58:33.717Z] DEBUG [api.financial-modeling-prep] Performance: healthCheck completed in 130ms
Metadata: {
  "type": "performance",
  "operation": "healthCheck",
  "duration": 130,
  "attempts": 1
}
[2025-09-26T14:58:37.011Z] INFO [FallbackDataService] FMP Plan detected: starter
Metadata: {
  "rateLimit": "300/minute",
  "dailyLimit": "999999/day",
  "priority": 1,
  "tier": "paid"
}
[2025-09-26T14:58:37.011Z] INFO [FallbackDataService] Fallback Data Service initialized with 5 free sources
Metadata: {
  "sources": [
    {
      "priority": 1,
      "name": "Financial Modeling Prep",
      "rateLimit": 300,
      "dailyLimit": 999999
    },
    {
      "priority": 2,
      "name": "Polygon",
      "rateLimit": 5,
      "dailyLimit": 50000
    },
    {
      "priority": 3,
      "name": "Yahoo Finance",
      "rateLimit": 60
    },
    {
      "priority": 4,
      "name": "Alpha Vantage",
      "rateLimit": 5,
      "dailyLimit": 25
    },
    {
      "priority": 5,
      "name": "Twelve Data",
      "rateLimit": 8,
      "dailyLimit": 800
    }
  ]
}
üî¨ Starting comprehensive analysis via StockSelectionService...
[2025-09-26T14:58:37.033Z] INFO [FallbackDataService] FMP Plan detected: starter
Metadata: {
  "rateLimit": "300/minute",
  "dailyLimit": "999999/day",
  "priority": 1,
  "tier": "paid"
}
[2025-09-26T14:58:37.033Z] INFO [FallbackDataService] Fallback Data Service initialized with 5 free sources
Metadata: {
  "sources": [
    {
      "priority": 1,
      "name": "Financial Modeling Prep",
      "rateLimit": 300,
      "dailyLimit": 999999
    },
    {
      "priority": 2,
      "name": "Polygon",
      "rateLimit": 5,
      "dailyLimit": 50000
    },
    {
      "priority": 3,
      "name": "Yahoo Finance",
      "rateLimit": 60
    },
    {
      "priority": 4,
      "name": "Alpha Vantage",
      "rateLimit": 5,
      "dailyLimit": 25
    },
    {
      "priority": 5,
      "name": "Twelve Data",
      "rateLimit": 8,
      "dailyLimit": 800
    }
  ]
}
‚úÖ ESG Data Service initialized with API key
üè≠ MacroeconomicAnalysisService initialized with data source orchestration
Reddit API Enhanced initialized for multi-subreddit sentiment analysis
‚úÖ ESG Data Service initialized with API key
‚úÖ Short Interest Service initialized with Polygon API integration
‚úÖ ESG Data Service initialized with API key
‚úÖ Comprehensive StockSelectionService initialized with full analysisInputServices
üìä Executing comprehensive stock analysis: {
  mode: 'single_stock',
  symbols: [ 'AAPL' ],
  sector: undefined,
  requestId: 'admin_test_1758898717035_pw7z4xkus'
}
‚úÖ Redis connected successfully
‚úÖ Redis connected successfully
Redis connected
üöÄ Redis ready for operations
üöÄ Redis ready for operations
üîß Building customized config for: composite
üìã Base config keys: [
  'id',
  'name',
  'description',
  'type',
  'enabled',
  'selectionCriteria',
  'universe',
  'weights',
  'selection',
  'risk',
  'dataFusion',
  'metadata'
]
üåå Base universe: { maxPositions: 40, marketCapMin: 500000000 }
‚úÖ Universe config built successfully: { maxPositions: 1, marketCapMin: 500000000, excludeSymbols: [] }
No data sources available in service config, using default
Using symbols from context: [AAPL]
Algorithm Composite Analysis Algorithm: Evaluating 1 stocks
üìä Using optimized batch size: 10 (FMP Starter: true)
Fetching fresh market data for AAPL...
[2025-09-26T14:58:37.038Z] DEBUG [FallbackDataService] Starting API call: getStockPrice
Metadata: {
  "timeout": 30000,
  "retries": 2
}
[2025-09-26T14:58:37.038Z] DEBUG [FallbackDataService] Optimal source selection for stock_price
Metadata: {
  "selectedSources": [
    {
      "name": "Twelve Data",
      "priority": 5,
      "rateLimit": 8,
      "currentUsage": 0
    },
    {
      "name": "Alpha Vantage",
      "priority": 4,
      "rateLimit": 5,
      "currentUsage": 0
    },
    {
      "name": "Yahoo Finance",
      "priority": 3,
      "rateLimit": 60,
      "currentUsage": 0
    }
  ],
  "totalAvailable": 5
}
[2025-09-26T14:58:37.038Z] DEBUG [FallbackDataService] Trying Twelve Data for AAPL
[2025-09-26T14:58:37.038Z] DEBUG [FallbackDataService] Starting API call: Twelve Data_getStockPrice
Metadata: {
  "timeout": 15000,
  "retries": 1
}
üåê TwelveData API URL: https://api.twelvedata.com/quote?symbol=AAPL&apikey=d9cb9bb2d6ef402a8311be460f983faa
[2025-09-26T14:58:37.039Z] DEBUG [FallbackDataService] Starting API call: getMarketData
Metadata: {
  "timeout": 20000,
  "retries": 1
}
[2025-09-26T14:58:37.039Z] DEBUG [FallbackDataService] Optimal source selection for market_data
Metadata: {
  "selectedSources": [
    {
      "name": "Twelve Data",
      "priority": 5,
      "rateLimit": 8,
      "currentUsage": 0
    },
    {
      "name": "Alpha Vantage",
      "priority": 4,
      "rateLimit": 5,
      "currentUsage": 0
    },
    {
      "name": "Yahoo Finance",
      "priority": 3,
      "rateLimit": 60,
      "currentUsage": 0
    }
  ],
  "totalAvailable": 5
}
[2025-09-26T14:58:37.039Z] DEBUG [FallbackDataService] Starting API call: Twelve Data_getMarketData
Metadata: {
  "timeout": 15000,
  "retries": 1
}
üåê TwelveData API URL: https://api.twelvedata.com/quote?symbol=AAPL&apikey=d9cb9bb2d6ef402a8311be460f983faa
[2025-09-26T14:58:37.039Z] DEBUG [FallbackDataService] Starting API call: getCompanyInfo
Metadata: {
  "timeout": 20000,
  "retries": 1
}
[2025-09-26T14:58:37.039Z] DEBUG [FallbackDataService] Optimal source selection for company_info
Metadata: {
  "selectedSources": [
    {
      "name": "Twelve Data",
      "priority": 5,
      "rateLimit": 8,
      "currentUsage": 0
    },
    {
      "name": "Alpha Vantage",
      "priority": 4,
      "rateLimit": 5,
      "currentUsage": 0
    },
    {
      "name": "Yahoo Finance",
      "priority": 3,
      "rateLimit": 60,
      "currentUsage": 0
    }
  ],
  "totalAvailable": 5
}
[2025-09-26T14:58:37.039Z] DEBUG [FallbackDataService] Starting API call: Twelve Data_getCompanyInfo
Metadata: {
  "timeout": 15000,
  "retries": 1
}
üåê TwelveData API URL: https://api.twelvedata.com/profile?symbol=AAPL&apikey=d9cb9bb2d6ef402a8311be460f983faa
[2025-09-26T14:58:37.215Z] DEBUG [FallbackDataService] Performance: Twelve Data_getMarketData completed in 176ms
Metadata: {
  "type": "performance",
  "operation": "Twelve Data_getMarketData",
  "duration": 176,
  "attempts": 1
}
[2025-09-26T14:58:37.215Z] DEBUG [FallbackDataService] Performance: getMarketData completed in 176ms
Metadata: {
  "type": "performance",
  "operation": "getMarketData",
  "duration": 176,
  "attempts": 1
}
[2025-09-26T14:58:37.252Z] DEBUG [FallbackDataService] Performance: Twelve Data_getCompanyInfo completed in 213ms
Metadata: {
  "type": "performance",
  "operation": "Twelve Data_getCompanyInfo",
  "duration": 213,
  "attempts": 1
}
[2025-09-26T14:58:37.252Z] DEBUG [FallbackDataService] Performance: getCompanyInfo completed in 213ms
Metadata: {
  "type": "performance",
  "operation": "getCompanyInfo",
  "duration": 213,
  "attempts": 1
}
[2025-09-26T14:58:37.253Z] DEBUG [FallbackDataService] Performance: Twelve Data_getStockPrice completed in 215ms
Metadata: {
  "type": "performance",
  "operation": "Twelve Data_getStockPrice",
  "duration": 215,
  "attempts": 1
}
[2025-09-26T14:58:37.254Z] DEBUG [FallbackDataService] Performance: Twelve Data_getStockPrice completed in 216ms
Metadata: {
  "type": "performance",
  "operation": "Twelve Data_getStockPrice",
  "duration": 216,
  "symbol": "AAPL",
  "source": "Twelve Data"
}
[2025-09-26T14:58:37.254Z] DEBUG [FallbackDataService] Performance: getStockPrice completed in 216ms
Metadata: {
  "type": "performance",
  "operation": "getStockPrice",
  "duration": 216,
  "attempts": 1
}
Got stock data for AAPL: price=255.13, volume=961070
‚úÖ Market data fetched for 1/1 symbols (100.0% success rate)
Fetched market data for 1 stocks
Fetched fundamental data for 1 stocks
Processing symbol AAPL, marketData keys: [AAPL]
Calculating score for AAPL with market data: { price: 255.13, volume: 961070 }
Starting score calculation for AAPL, weights count: 10
üéØ COMPOSITE ALGORITHM DETECTED - Using enhanced composite factor calculation
üì∞ Pre-fetching sentiment data for AAPL...
üì∞ Sentiment pre-fetched for AAPL: 0.4992915555555555
üìä Pre-fetching VWAP analysis for AAPL...
Polygon API: Fetching prev data for AAPL
üìä VWAP pre-fetched for AAPL: success
üåç Pre-fetching macroeconomic context for AAPL (Technology)...
üìä Returning cached macro context (0ms)
üåç Macro context pre-fetched for AAPL: success
üå± Pre-fetching ESG data for AAPL (Technology)...
‚úÖ ESG Data Service initialized with API key
üå± Analyzing ESG impact for AAPL (Technology)
üå± ESG pre-fetched for AAPL: 0.810
üìä Pre-fetching short interest data for AAPL (Technology)...
‚úÖ Short Interest Service initialized with Polygon API integration
üìä Analyzing short interest impact for AAPL (Technology)
üìä Short interest data for AAPL retrieved from cache
üìä Short interest pre-fetched for AAPL: score 0.499, impact neutral
üïí Pre-fetching extended market data for AAPL...
‚úÖ Redis connected successfully
üöÄ Redis ready for operations
Polygon API: Fetching prev data for AAPL
Polygon API: Fetching prev data for AAPL
üïí Extended market data pre-fetched for AAPL: extended hours data market-hours, liquidity N/A
Starting calculation of factor composite for AAPL
üéØ Calculating MAIN composite score for AAPL with ALL required components
üîç Attempting to calculate technical overall score for AAPL
Fetching 250 days of historical data for AAPL
üåê TwelveData API URL: https://api.twelvedata.com/time_series?symbol=AAPL&interval=1day&outputsize=100&apikey=d9cb9bb2d6ef402a8311be460f983faa
TwelveData: Retrieved 100 OHLC records for AAPL
Successfully fetched 100 historical price points for AAPL
‚úÖ Using 100 data points for technical analysis of AAPL
üìä Technical analysis result for AAPL: 56/100
Technical Analysis: 0.560 (weight: 38.1%) ‚ö°
Calculating quality composite for data: {
  roe: undefined,
  debtToEquity: undefined,
  currentRatio: undefined,
  operatingMargin: undefined,
  netProfitMargin: undefined,
  grossProfitMargin: undefined
}
Quality factor ROE: No valid data (null)
Quality factor Debt/Equity: No valid data (null)
Quality factor Current Ratio: No valid data (null)
Quality factor Operating Margin: No valid data (null)
Quality factor Gross Profit Margin: No valid data (null)
Insufficient quality factors: only 0 valid factors found
Fundamental Analysis: No data (fallback to neutral 0.5)
üåç Calculating macroeconomic composite from pre-fetched data...
üåç Macroeconomic composite score: 1.000 (confidence: 1)
üåç Macroeconomic Analysis: 1.000 (weight: 19.0%) - INTEGRATED!
üì∞ Sentiment Analysis: 0.499 (weight: 9.5%) - INTEGRATED!
Extended Market Data service not available
üíπ Extended Market Data: 0.500 (weight: 4.8%) - INTEGRATED!
Short Interest service not available
üìä Short Interest Analysis: 0.500 (weight: 2.4%) - INTEGRATED!
üå± ESG Analysis: 0.810 (weight: 2.4%) - INTEGRATED!
üéØ Main composite calculation for AAPL:
   Final weighted score: 0.6252
   Weight Allocation: Technical(38.1%) + Fundamental(23.8%) + Macroeconomic(19.0%) + Sentiment(9.5%) + Extended Market(4.8%) + Short Interest(2.4%) + ESG(2.4%) = 100.0%
   ‚úÖ WEIGHT VERIFICATION: Total weights = 1.000 (target: 1.000)
   Contributing factors: [technicalAnalysis, technical_overall_score, macroeconomicAnalysis, macroeconomic_composite, sentimentAnalysis, sentiment_composite, extendedMarketData, extended_market_composite, shortInterestAnalysis, short_interest_composite, esgAnalysis, esg_composite]
‚úÖ Factor composite for AAPL: 0.6252 (calculated in 158ms)
üéØ Enhanced composite score for AAPL: 0.6252326977777778
‚úÖ Technical overall score for AAPL: 0.560 - TRACKED
Starting calculation of factor quality_composite for AAPL
Calculating quality composite for data: {
  roe: undefined,
  debtToEquity: undefined,
  currentRatio: undefined,
  operatingMargin: undefined,
  netProfitMargin: undefined,
  grossProfitMargin: undefined
}
Quality factor ROE: No valid data (null)
Quality factor Debt/Equity: No valid data (null)
Quality factor Current Ratio: No valid data (null)
Quality factor Operating Margin: No valid data (null)
Quality factor Gross Profit Margin: No valid data (null)
Insufficient quality factors: only 0 valid factors found
‚ö†Ô∏è Factor quality_composite for AAPL: returned null/NaN (0ms)
Starting calculation of factor momentum_composite for AAPL
Calculating momentum composite for AAPL
Fetching 127 days of historical data for AAPL
üåê TwelveData API URL: https://api.twelvedata.com/time_series?symbol=AAPL&interval=1day&outputsize=100&apikey=d9cb9bb2d6ef402a8311be460f983faa
TwelveData: Retrieved 100 OHLC records for AAPL
Successfully fetched 100 historical price points for AAPL
Momentum factor 1-month momentum: 0.631 (weight: 0.25)
Momentum factor 3-month momentum: 0.793 (weight: 0.3)
Momentum factor 6-month momentum: No data available
Momentum factor RSI: No data available
Momentum factor MACD: No data available
Momentum composite score for AAPL: 0.719 (based on 0.55 total weight)
‚úÖ Factor momentum_composite for AAPL: 0.7192 (calculated in 124ms)
Starting calculation of factor value_composite for AAPL
Calculating value composite for data: {
  peRatio: undefined,
  pbRatio: undefined,
  priceToSales: undefined,
  evEbitda: undefined,
  marketCap: 0
}
Value factor P/E Ratio: No valid data (null)
Value factor P/B Ratio: No valid data (null)
Value factor P/S Ratio: No valid data (null)
Value factor EV/EBITDA: No valid data (null)
Insufficient value factors: only 0 valid factors found
‚ö†Ô∏è Factor value_composite for AAPL: returned null/NaN (1ms)
Starting calculation of factor volatility_30d for AAPL
Calculating 30-day volatility for AAPL
Calculated 29 daily returns for AAPL
AAPL volatility stats: {
  periods: 29,
  dailyVol: '0.0160',
  annualizedVol: '0.2541',
  meanReturn: '0.0035'
}
AAPL volatility score: 0.746 (lower volatility = higher score)
‚úÖ Factor volatility_30d for AAPL: 0.7459 (calculated in 0ms)
‚úÖ Sentiment score for AAPL: 0.499 - TRACKED
Starting calculation of factor vwap_deviation_score for AAPL
üìä Calculating VWAP deviation score from pre-fetched data...
‚úÖ Factor vwap_deviation_score for AAPL: 0.3000 (calculated in 0ms)
‚úÖ VWAP deviation score for AAPL: 0.300 - TRACKED
Starting calculation of factor vwap_trading_signals for AAPL
üìä Calculating VWAP trading signals from pre-fetched data...
üìä VWAP trading signal: above with weak strength = 0.560
‚úÖ Factor vwap_trading_signals for AAPL: 0.5600 (calculated in 0ms)
‚úÖ VWAP trading signals for AAPL: 0.560 - TRACKED
Starting calculation of factor vwap_trend_analysis for AAPL
üìä Calculating VWAP trend score with historical analysis...
üìä No VWAP trend insights available for AAPL - using fallback
üìä Calculating VWAP trading signals from pre-fetched data...
üìä VWAP trading signal: above with weak strength = 0.560
‚úÖ Factor vwap_trend_analysis for AAPL: 0.5600 (calculated in 137ms)
‚úÖ VWAP trend analysis for AAPL: 0.560 - TRACKED
Starting calculation of factor macroeconomic_sector_impact for AAPL
üåç Calculating macroeconomic sector impact from pre-fetched data...
üåç Macro sector impact for Technology: positive = 0.900
‚úÖ Factor macroeconomic_sector_impact for AAPL: 0.9000 (calculated in 1ms)
‚úÖ Macro sector impact for AAPL: 0.900 - TRACKED
Starting calculation of factor macroeconomic_composite for AAPL
üåç Calculating macroeconomic composite from pre-fetched data...
üåç Macroeconomic composite score: 1.000 (confidence: 1)
‚úÖ Factor macroeconomic_composite for AAPL: 1.0000 (calculated in 0ms)
‚úÖ Macroeconomic composite for AAPL: 1.000 - TRACKED
Starting calculation of factor esg_composite for AAPL
üå± Analyzing ESG impact for AAPL (Technology)
‚úÖ Factor esg_composite for AAPL: 0.8100 (calculated in 1ms)
‚úÖ ESG composite score for AAPL: 0.810 - TRACKED
Starting calculation of factor short_interest_composite for AAPL
Short Interest service not available
‚úÖ Factor short_interest_composite for AAPL: 0.5000 (calculated in 0ms)
Starting calculation of factor extended_market_composite for AAPL
Extended Market Data service not available
‚úÖ Factor extended_market_composite for AAPL: 0.5000 (calculated in 0ms)
Successfully calculated score for AAPL: 0.6252326977777778
Calculated scores for 1 stocks
Selected 1 stocks after applying criteria
üîç Getting stock price for AAPL using smart fallback chain...
[2025-09-26T14:58:38.057Z] DEBUG [FallbackDataService] Starting API call: getFundamentalRatios
Metadata: {
  "timeout": 30000,
  "retries": 2
}
[2025-09-26T14:58:38.057Z] DEBUG [FallbackDataService] Starting API call: Financial Modeling Prep_getFundamentalRatios
Metadata: {
  "timeout": 20000,
  "retries": 1
}
[2025-09-26T14:58:38.057Z] DEBUG [api.financial-modeling-prep] Starting API call: getFundamentalRatios
Metadata: {
  "timeout": 15000,
  "retries": 2
}
[2025-09-26T14:58:38.059Z] DEBUG [FallbackDataService] Starting API call: Yahoo Finance_getFundamentalRatios
Metadata: {
  "timeout": 20000,
  "retries": 1
}
üìä Fetching fundamental data from yfinance for AAPL
[2025-09-26T14:58:38.066Z] DEBUG [FallbackDataService] Starting API call: getStockPrice
Metadata: {
  "timeout": 30000,
  "retries": 2
}
[2025-09-26T14:58:38.066Z] DEBUG [FallbackDataService] Optimal source selection for stock_price
Metadata: {
  "selectedSources": [
    {
      "name": "Twelve Data",
      "priority": 5,
      "rateLimit": 8,
      "currentUsage": 0
    },
    {
      "name": "Alpha Vantage",
      "priority": 4,
      "rateLimit": 5,
      "currentUsage": 0
    },
    {
      "name": "Yahoo Finance",
      "priority": 3,
      "rateLimit": 60,
      "currentUsage": 0
    }
  ],
  "totalAvailable": 5
}
[2025-09-26T14:58:38.066Z] DEBUG [FallbackDataService] Trying Twelve Data for AAPL
[2025-09-26T14:58:38.066Z] DEBUG [FallbackDataService] Starting API call: Twelve Data_getStockPrice
Metadata: {
  "timeout": 15000,
  "retries": 1
}
üåê TwelveData API URL: https://api.twelvedata.com/quote?symbol=AAPL&apikey=d9cb9bb2d6ef402a8311be460f983faa
[2025-09-26T14:58:38.094Z] WARN [api.financial-modeling-prep] Invalid ratios response structure
Metadata: {
  "errors": [
    "Invalid response data structure"
  ],
  "symbol": "AAPL"
}
[2025-09-26T14:58:38.095Z] WARN [api.financial-modeling-prep] Invalid metrics response structure
Metadata: {
  "errors": [
    "Invalid response data structure"
  ],
  "symbol": "AAPL"
}
[2025-09-26T14:58:38.095Z] WARN [api.financial-modeling-prep] Invalid pbRatio value for AAPL
Metadata: {
  "fieldName": "pbRatio",
  "value": 57.75519180191402,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T14:58:38.095Z] WARN [api.financial-modeling-prep] Invalid priceToSales value for AAPL
Metadata: {
  "fieldName": "priceToSales",
  "value": 9.265415226185379,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T14:58:38.095Z] WARN [api.financial-modeling-prep] Invalid currentRatio value for AAPL
Metadata: {
  "fieldName": "currentRatio",
  "value": 0.8679917800453515,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T14:58:38.095Z] WARN [api.financial-modeling-prep] Invalid quickRatio value for AAPL
Metadata: {
  "fieldName": "quickRatio",
  "value": 0.8260062358276644,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T14:58:38.095Z] WARN [api.financial-modeling-prep] Invalid grossProfitMargin value for AAPL
Metadata: {
  "fieldName": "grossProfitMargin",
  "value": 0.4667825022942796,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T14:58:38.095Z] WARN [api.financial-modeling-prep] Invalid operatingMargin value for AAPL
Metadata: {
  "fieldName": "operatingMargin",
  "value": 0.31866381156316914,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T14:58:38.095Z] WARN [api.financial-modeling-prep] Invalid netProfitMargin value for AAPL
Metadata: {
  "fieldName": "netProfitMargin",
  "value": 0.24296115019883757,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T14:58:38.095Z] WARN [api.financial-modeling-prep] Invalid dividendYield value for AAPL
Metadata: {
  "fieldName": "dividendYield",
  "value": 0.00399812,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T14:58:38.095Z] DEBUG [api.financial-modeling-prep] Performance: getFundamentalRatios completed in 38ms
Metadata: {
  "type": "performance",
  "operation": "getFundamentalRatios",
  "duration": 38,
  "attempts": 1
}
[2025-09-26T14:58:38.095Z] DEBUG [FallbackDataService] Performance: Financial Modeling Prep_getFundamentalRatios completed in 38ms
Metadata: {
  "type": "performance",
  "operation": "Financial Modeling Prep_getFundamentalRatios",
  "duration": 38,
  "attempts": 1
}
[2025-09-26T14:58:38.095Z] INFO [FallbackDataService] Fundamental ratios from Financial Modeling Prep for AAPL
Metadata: {
  "peRatio": "N/A",
  "pbRatio": "N/A",
  "source": "Financial Modeling Prep"
}
üéØ Price targets from Financial Modeling Prep for AAPL: $241.26 (-5.4% upside)
[2025-09-26T14:58:38.195Z] DEBUG [FallbackDataService] Performance: Twelve Data_getStockPrice completed in 129ms
Metadata: {
  "type": "performance",
  "operation": "Twelve Data_getStockPrice",
  "duration": 129,
  "attempts": 1
}
[2025-09-26T14:58:38.195Z] DEBUG [FallbackDataService] Performance: Twelve Data_getStockPrice completed in 129ms
Metadata: {
  "type": "performance",
  "operation": "Twelve Data_getStockPrice",
  "duration": 129,
  "symbol": "AAPL",
  "source": "Twelve Data"
}
[2025-09-26T14:58:38.196Z] DEBUG [FallbackDataService] Performance: getStockPrice completed in 130ms
Metadata: {
  "type": "performance",
  "operation": "getStockPrice",
  "duration": 130,
  "attempts": 1
}
‚úÖ Got AAPL price: $255.13 from twelve_data
‚úÖ yfinance fundamental data retrieved for AAPL: { peRatio: '38.66', roe: '149.81%', debtToEquity: '154.49' }
[2025-09-26T14:58:38.761Z] DEBUG [FallbackDataService] Performance: Yahoo Finance_getFundamentalRatios completed in 702ms
Metadata: {
  "type": "performance",
  "operation": "Yahoo Finance_getFundamentalRatios",
  "duration": 702,
  "attempts": 1
}
[2025-09-26T14:58:38.761Z] INFO [FallbackDataService] Fundamental ratios from Yahoo Finance for AAPL
Metadata: {
  "peRatio": "38.66",
  "pbRatio": "57.59",
  "source": "Yahoo Finance"
}
[2025-09-26T14:58:38.761Z] DEBUG [FallbackDataService] Performance: getFundamentalRatios completed in 704ms
Metadata: {
  "type": "performance",
  "operation": "getFundamentalRatios",
  "duration": 704,
  "attempts": 1
}
[2025-09-26T14:58:38.761Z] DEBUG [FMPCacheManager] Cache entry set for fmp:fundamental_ratios:AAPL
Metadata: {
  "dataType": "fundamental_ratios",
  "ttl": "3600s",
  "compressed": false,
  "size": "0.1KB"
}
[2025-09-26T14:58:38.761Z] DEBUG [FallbackDataService] Cached fundamental ratios for AAPL
[2025-09-26T14:58:38.829Z] INFO [api.financial-modeling-prep] Generated synthetic analyst ratings for AAPL from price targets
Metadata: {
  "consensus": "Sell",
  "totalAnalysts": 9,
  "sentimentScore": 2
}
üìä Analyst ratings from Financial Modeling Prep for AAPL: Sell (9 analysts)
Enhanced factors for utilization: [macroeconomic_composite, fundamentalData, fundamentals, macroeconomic_sector_impact, esg_composite]
Primary factors extracted for AAPL: [
  'macroeconomic_composite',
  'fundamentalData',
  'fundamentals',
  'macroeconomic_sector_impact',
  'esg_composite'
]
üìä Returning cached macro context (0ms)
üì∞ Analyzing sentiment impact for AAPL (Technology)
üå± Analyzing ESG impact for AAPL (Technology)
üìä Analyzing short interest impact for AAPL (Technology)
üìä Short interest data for AAPL retrieved from cache
üîç Service utilization for technicalAnalysis: 1/1 = 100%
üîç Service utilization for fundamentals: 1/1 = 100%
üîç Service utilization for macroeconomicAnalysis: 1/1 = 100%
üîç Service utilization for sentimentAnalysis: 1/1 = 100%
üîç Service utilization for vwapAnalysis: 1/1 = 100%
üîç Service utilization for esgAnalysis: 1/1 = 100%
üîç Service utilization for shortInterestAnalysis: 0/1 = 0%
‚ö†Ô∏è  Debugging 0% utilization for shortInterestAnalysis:
  Stock 1 (AAPL): 11 factors: [ 'esg_composite' ]
Actual cache hit rate: 0/0 = 0.0%
‚úÖ Comprehensive analysis completed in 1798ms { success: true, topSelections: 1, analysisInputServices: 10 }
 POST /api/stocks/analyze 200 in 1886ms
 GET /api/market/sectors 200 in 6185ms
 ‚úì Compiled in 18ms
 ‚úì Compiled /api/stocks/analyze in 101ms (298 modules)
[2025-09-26T15:01:21.525Z] INFO [FallbackDataService] FMP Plan detected: starter
Metadata: {
  "rateLimit": "300/minute",
  "dailyLimit": "999999/day",
  "priority": 1,
  "tier": "paid"
}
[2025-09-26T15:01:21.525Z] INFO [FallbackDataService] Fallback Data Service initialized with 5 free sources
Metadata: {
  "sources": [
    {
      "priority": 1,
      "name": "Financial Modeling Prep",
      "rateLimit": 300,
      "dailyLimit": 999999
    },
    {
      "priority": 2,
      "name": "Polygon",
      "rateLimit": 5,
      "dailyLimit": 50000
    },
    {
      "priority": 3,
      "name": "Yahoo Finance",
      "rateLimit": 60
    },
    {
      "priority": 4,
      "name": "Alpha Vantage",
      "rateLimit": 5,
      "dailyLimit": 25
    },
    {
      "priority": 5,
      "name": "Twelve Data",
      "rateLimit": 8,
      "dailyLimit": 800
    }
  ]
}
üî¨ Starting comprehensive analysis via StockSelectionService...
[2025-09-26T15:01:21.565Z] INFO [FallbackDataService] FMP Plan detected: starter
Metadata: {
  "rateLimit": "300/minute",
  "dailyLimit": "999999/day",
  "priority": 1,
  "tier": "paid"
}
[2025-09-26T15:01:21.565Z] INFO [FallbackDataService] Fallback Data Service initialized with 5 free sources
Metadata: {
  "sources": [
    {
      "priority": 1,
      "name": "Financial Modeling Prep",
      "rateLimit": 300,
      "dailyLimit": 999999
    },
    {
      "priority": 2,
      "name": "Polygon",
      "rateLimit": 5,
      "dailyLimit": 50000
    },
    {
      "priority": 3,
      "name": "Yahoo Finance",
      "rateLimit": 60
    },
    {
      "priority": 4,
      "name": "Alpha Vantage",
      "rateLimit": 5,
      "dailyLimit": 25
    },
    {
      "priority": 5,
      "name": "Twelve Data",
      "rateLimit": 8,
      "dailyLimit": 800
    }
  ]
}
‚úÖ ESG Data Service initialized with API key
üè≠ MacroeconomicAnalysisService initialized with data source orchestration
Reddit API Enhanced initialized for multi-subreddit sentiment analysis
‚úÖ ESG Data Service initialized with API key
‚úÖ Short Interest Service initialized with Polygon API integration
‚úÖ ESG Data Service initialized with API key
‚úÖ Comprehensive StockSelectionService initialized with full analysisInputServices
üìä Executing comprehensive stock analysis: {
  mode: 'single_stock',
  symbols: [ 'AAPL' ],
  sector: undefined,
  requestId: 'admin_test_1758898881567_2b6gbur5a'
}
‚úÖ Redis connected successfully
‚úÖ Redis connected successfully
‚úÖ Redis connected successfully
Redis connected
üöÄ Redis ready for operations
üöÄ Redis ready for operations
üöÄ Redis ready for operations
üîß Building customized config for: composite
üìã Base config keys: [
  'id',
  'name',
  'description',
  'type',
  'enabled',
  'selectionCriteria',
  'universe',
  'weights',
  'selection',
  'risk',
  'dataFusion',
  'metadata'
]
üåå Base universe: { maxPositions: 40, marketCapMin: 500000000 }
‚úÖ Universe config built successfully: { maxPositions: 1, marketCapMin: 500000000, excludeSymbols: [] }
No data sources available in service config, using default
Using symbols from context: [AAPL]
Algorithm Composite Analysis Algorithm: Evaluating 1 stocks
üìä Using optimized batch size: 10 (FMP Starter: true)
Fetching fresh market data for AAPL...
[2025-09-26T15:01:21.571Z] DEBUG [FallbackDataService] Starting API call: getStockPrice
Metadata: {
  "timeout": 30000,
  "retries": 2
}
[2025-09-26T15:01:21.571Z] DEBUG [FallbackDataService] Optimal source selection for stock_price
Metadata: {
  "selectedSources": [
    {
      "name": "Twelve Data",
      "priority": 5,
      "rateLimit": 8,
      "currentUsage": 0
    },
    {
      "name": "Alpha Vantage",
      "priority": 4,
      "rateLimit": 5,
      "currentUsage": 0
    },
    {
      "name": "Yahoo Finance",
      "priority": 3,
      "rateLimit": 60,
      "currentUsage": 0
    }
  ],
  "totalAvailable": 5
}
[2025-09-26T15:01:21.571Z] DEBUG [FallbackDataService] Trying Twelve Data for AAPL
[2025-09-26T15:01:21.571Z] DEBUG [FallbackDataService] Starting API call: Twelve Data_getStockPrice
Metadata: {
  "timeout": 15000,
  "retries": 1
}
üåê TwelveData API URL: https://api.twelvedata.com/quote?symbol=AAPL&apikey=d9cb9bb2d6ef402a8311be460f983faa
[2025-09-26T15:01:21.572Z] DEBUG [FallbackDataService] Starting API call: getMarketData
Metadata: {
  "timeout": 20000,
  "retries": 1
}
[2025-09-26T15:01:21.572Z] DEBUG [FallbackDataService] Optimal source selection for market_data
Metadata: {
  "selectedSources": [
    {
      "name": "Twelve Data",
      "priority": 5,
      "rateLimit": 8,
      "currentUsage": 0
    },
    {
      "name": "Alpha Vantage",
      "priority": 4,
      "rateLimit": 5,
      "currentUsage": 0
    },
    {
      "name": "Yahoo Finance",
      "priority": 3,
      "rateLimit": 60,
      "currentUsage": 0
    }
  ],
  "totalAvailable": 5
}
[2025-09-26T15:01:21.572Z] DEBUG [FallbackDataService] Starting API call: Twelve Data_getMarketData
Metadata: {
  "timeout": 15000,
  "retries": 1
}
üåê TwelveData API URL: https://api.twelvedata.com/quote?symbol=AAPL&apikey=d9cb9bb2d6ef402a8311be460f983faa
[2025-09-26T15:01:21.573Z] DEBUG [FallbackDataService] Starting API call: getCompanyInfo
Metadata: {
  "timeout": 20000,
  "retries": 1
}
[2025-09-26T15:01:21.573Z] DEBUG [FallbackDataService] Optimal source selection for company_info
Metadata: {
  "selectedSources": [
    {
      "name": "Twelve Data",
      "priority": 5,
      "rateLimit": 8,
      "currentUsage": 0
    },
    {
      "name": "Alpha Vantage",
      "priority": 4,
      "rateLimit": 5,
      "currentUsage": 0
    },
    {
      "name": "Yahoo Finance",
      "priority": 3,
      "rateLimit": 60,
      "currentUsage": 0
    }
  ],
  "totalAvailable": 5
}
[2025-09-26T15:01:21.573Z] DEBUG [FallbackDataService] Starting API call: Twelve Data_getCompanyInfo
Metadata: {
  "timeout": 15000,
  "retries": 1
}
üåê TwelveData API URL: https://api.twelvedata.com/profile?symbol=AAPL&apikey=d9cb9bb2d6ef402a8311be460f983faa
[2025-09-26T15:01:21.729Z] DEBUG [FallbackDataService] Performance: Twelve Data_getStockPrice completed in 158ms
Metadata: {
  "type": "performance",
  "operation": "Twelve Data_getStockPrice",
  "duration": 158,
  "attempts": 1
}
[2025-09-26T15:01:21.729Z] DEBUG [FallbackDataService] Performance: Twelve Data_getStockPrice completed in 158ms
Metadata: {
  "type": "performance",
  "operation": "Twelve Data_getStockPrice",
  "duration": 158,
  "symbol": "AAPL",
  "source": "Twelve Data"
}
[2025-09-26T15:01:21.729Z] DEBUG [FallbackDataService] Performance: getStockPrice completed in 158ms
Metadata: {
  "type": "performance",
  "operation": "getStockPrice",
  "duration": 158,
  "attempts": 1
}
[2025-09-26T15:01:21.736Z] DEBUG [FallbackDataService] Performance: Twelve Data_getCompanyInfo completed in 163ms
Metadata: {
  "type": "performance",
  "operation": "Twelve Data_getCompanyInfo",
  "duration": 163,
  "attempts": 1
}
[2025-09-26T15:01:21.736Z] DEBUG [FallbackDataService] Performance: getCompanyInfo completed in 163ms
Metadata: {
  "type": "performance",
  "operation": "getCompanyInfo",
  "duration": 163,
  "attempts": 1
}
[2025-09-26T15:01:21.836Z] DEBUG [FallbackDataService] Performance: Twelve Data_getMarketData completed in 264ms
Metadata: {
  "type": "performance",
  "operation": "Twelve Data_getMarketData",
  "duration": 264,
  "attempts": 1
}
[2025-09-26T15:01:21.836Z] DEBUG [FallbackDataService] Performance: getMarketData completed in 264ms
Metadata: {
  "type": "performance",
  "operation": "getMarketData",
  "duration": 264,
  "attempts": 1
}
Got stock data for AAPL: price=255.03, volume=976092
‚úÖ Market data fetched for 1/1 symbols (100.0% success rate)
Fetched market data for 1 stocks
Fetched fundamental data for 1 stocks
Processing symbol AAPL, marketData keys: [AAPL]
Calculating score for AAPL with market data: { price: 255.03, volume: 976092 }
Starting score calculation for AAPL, weights count: 10
üéØ COMPOSITE ALGORITHM DETECTED - Using enhanced composite factor calculation
üì∞ Pre-fetching sentiment data for AAPL...
üì∞ Sentiment pre-fetched for AAPL: 0.4992915555555555
üìä Pre-fetching VWAP analysis for AAPL...
Polygon API: Fetching prev data for AAPL
üìä VWAP pre-fetched for AAPL: success
üåç Pre-fetching macroeconomic context for AAPL (Technology)...
üîç Fetching fresh macroeconomic context with parallel processing...
üîç Getting latest observation for PET.RWTC.D...
üåê EIA API URL: https://api.eia.gov/v2/seriesid/PET.RWTC.D?api_key=qAU83CqOXOVXduLuhimcS5d09lFWmMW6vU67bcFJ&length=1
üîç Getting latest observation for PET.RBRTE.D...
üåê EIA API URL: https://api.eia.gov/v2/seriesid/PET.RBRTE.D?api_key=qAU83CqOXOVXduLuhimcS5d09lFWmMW6vU67bcFJ&length=1
üîç Getting latest observation for NG.RNGWHHD.D...
üåê EIA API URL: https://api.eia.gov/v2/seriesid/NG.RNGWHHD.D?api_key=qAU83CqOXOVXduLuhimcS5d09lFWmMW6vU67bcFJ&length=1
üîç Getting latest observation for PET.EMM_EPMR_PTE_NUS_DPG.W...
üåê EIA API URL: https://api.eia.gov/v2/seriesid/PET.EMM_EPMR_PTE_NUS_DPG.W?api_key=qAU83CqOXOVXduLuhimcS5d09lFWmMW6vU67bcFJ&length=1
üìä Returning cached economic context
üìä Returning cached inflation trend analysis
üìä Returning cached monetary policy context
üìä Returning cached economic cycle position
Unemployment trend analysis completed in 280ms
Payroll momentum analysis completed in 115ms
Employment strength scoring completed in 624ms
üìä Response for PET.RWTC.D: {
  success: true,
  hasData: true,
  hasResponse: true,
  dataLength: 1,
  error: undefined
}
‚úÖ Found observation for PET.RWTC.D: {
  period: '2025-09-22',
  duoarea: 'YCUOK',
  'area-name': 'NA',
  product: 'EPCWTI',
  'product-name': 'WTI Crude Oil',
  process: 'PF4',
  'process-name': 'Spot Price FOB',
  series: 'RWTC',
  'series-description': 'Cushing, OK WTI Spot Price FOB (Dollars per Barrel)',
  value: 62.99,
  units: '$/BBL'
}
üìä Response for PET.RBRTE.D: {
  success: true,
  hasData: true,
  hasResponse: true,
  dataLength: 1,
  error: undefined
}
‚úÖ Found observation for PET.RBRTE.D: {
  period: '2025-09-22',
  duoarea: 'ZEU',
  'area-name': 'NA',
  product: 'EPCBRENT',
  'product-name': 'UK Brent Crude Oil',
  process: 'PF4',
  'process-name': 'Spot Price FOB',
  series: 'RBRTE',
  'series-description': 'Europe Brent Spot Price FOB (Dollars per Barrel)',
  value: 66.87,
  units: '$/BBL'
}
üìä Response for PET.EMM_EPMR_PTE_NUS_DPG.W: {
  success: true,
  hasData: true,
  hasResponse: true,
  dataLength: 1,
  error: undefined
}
‚úÖ Found observation for PET.EMM_EPMR_PTE_NUS_DPG.W: {
  period: '2025-09-22',
  duoarea: 'NUS',
  'area-name': 'U.S.',
  product: 'EPMR',
  'product-name': 'Regular Gasoline',
  process: 'PTE',
  'process-name': 'Retail Sales',
  series: 'EMM_EPMR_PTE_NUS_DPG',
  'series-description': 'U.S. Regular All Formulations Retail Gasoline Prices (Dollars per Gallon)',
  value: 3.173,
  units: '$/GAL'
}
üìä Response for NG.RNGWHHD.D: {
  success: true,
  hasData: true,
  hasResponse: true,
  dataLength: 1,
  error: undefined
}
‚úÖ Found observation for NG.RNGWHHD.D: {
  period: '2025-09-22',
  duoarea: 'RGC',
  'area-name': 'NA',
  product: 'EPG0',
  'product-name': 'Natural Gas',
  process: 'PS0',
  'process-name': 'Spot Price',
  series: 'RNGWHHD',
  'series-description': 'Henry Hub Natural Gas Spot Price (Dollars per Million Btu)',
  value: 2.9,
  units: '$/MMBTU'
}
‚ö° Quick commodity snapshot in 19212ms
‚úÖ Macro context generated in 19216ms with 100.0% efficiency
‚ö†Ô∏è Performance target missed: 19216ms > 800ms target
üåç Macro context pre-fetched for AAPL: success
üå± Pre-fetching ESG data for AAPL (Technology)...
‚úÖ ESG Data Service initialized with API key
üå± Analyzing ESG impact for AAPL (Technology)
üå± ESG pre-fetched for AAPL: 0.810
üìä Pre-fetching short interest data for AAPL (Technology)...
‚úÖ Short Interest Service initialized with Polygon API integration
üìä Analyzing short interest impact for AAPL (Technology)
üìä Short interest data for AAPL retrieved from cache
üìä Short interest pre-fetched for AAPL: score 0.499, impact neutral
üïí Pre-fetching extended market data for AAPL...
‚úÖ Redis connected successfully
üöÄ Redis ready for operations
Polygon API: Fetching prev data for AAPL
Polygon API: Fetching prev data for AAPL
üïí Extended market data pre-fetched for AAPL: extended hours data market-hours, liquidity N/A
Starting calculation of factor composite for AAPL
üéØ Calculating MAIN composite score for AAPL with ALL required components
üîç Attempting to calculate technical overall score for AAPL
Fetching 250 days of historical data for AAPL
üåê TwelveData API URL: https://api.twelvedata.com/time_series?symbol=AAPL&interval=1day&outputsize=100&apikey=d9cb9bb2d6ef402a8311be460f983faa
TwelveData: Retrieved 100 OHLC records for AAPL
Successfully fetched 100 historical price points for AAPL
‚úÖ Using 100 data points for technical analysis of AAPL
üìä Technical analysis result for AAPL: 56/100
Technical Analysis: 0.560 (weight: 38.1%) ‚ö°
Calculating quality composite for data: {
  roe: undefined,
  debtToEquity: undefined,
  currentRatio: undefined,
  operatingMargin: undefined,
  netProfitMargin: undefined,
  grossProfitMargin: undefined
}
Quality factor ROE: No valid data (null)
Quality factor Debt/Equity: No valid data (null)
Quality factor Current Ratio: No valid data (null)
Quality factor Operating Margin: No valid data (null)
Quality factor Gross Profit Margin: No valid data (null)
Insufficient quality factors: only 0 valid factors found
Fundamental Analysis: No data (fallback to neutral 0.5)
üåç Calculating macroeconomic composite from pre-fetched data...
üåç Macroeconomic composite score: 1.000 (confidence: 1)
üåç Macroeconomic Analysis: 1.000 (weight: 19.0%) - INTEGRATED!
üì∞ Sentiment Analysis: 0.499 (weight: 9.5%) - INTEGRATED!
Extended Market Data service not available
üíπ Extended Market Data: 0.500 (weight: 4.8%) - INTEGRATED!
Short Interest service not available
üìä Short Interest Analysis: 0.500 (weight: 2.4%) - INTEGRATED!
üå± ESG Analysis: 0.810 (weight: 2.4%) - INTEGRATED!
üéØ Main composite calculation for AAPL:
   Final weighted score: 0.6252
   Weight Allocation: Technical(38.1%) + Fundamental(23.8%) + Macroeconomic(19.0%) + Sentiment(9.5%) + Extended Market(4.8%) + Short Interest(2.4%) + ESG(2.4%) = 100.0%
   ‚úÖ WEIGHT VERIFICATION: Total weights = 1.000 (target: 1.000)
   Contributing factors: [technicalAnalysis, technical_overall_score, macroeconomicAnalysis, macroeconomic_composite, sentimentAnalysis, sentiment_composite, extendedMarketData, extended_market_composite, shortInterestAnalysis, short_interest_composite, esgAnalysis, esg_composite]
‚úÖ Factor composite for AAPL: 0.6252 (calculated in 178ms)
üéØ Enhanced composite score for AAPL: 0.6252326977777778
‚úÖ Technical overall score for AAPL: 0.560 - TRACKED
Starting calculation of factor quality_composite for AAPL
Calculating quality composite for data: {
  roe: undefined,
  debtToEquity: undefined,
  currentRatio: undefined,
  operatingMargin: undefined,
  netProfitMargin: undefined,
  grossProfitMargin: undefined
}
Quality factor ROE: No valid data (null)
Quality factor Debt/Equity: No valid data (null)
Quality factor Current Ratio: No valid data (null)
Quality factor Operating Margin: No valid data (null)
Quality factor Gross Profit Margin: No valid data (null)
Insufficient quality factors: only 0 valid factors found
‚ö†Ô∏è Factor quality_composite for AAPL: returned null/NaN (0ms)
Starting calculation of factor momentum_composite for AAPL
Calculating momentum composite for AAPL
Fetching 127 days of historical data for AAPL
üåê TwelveData API URL: https://api.twelvedata.com/time_series?symbol=AAPL&interval=1day&outputsize=100&apikey=d9cb9bb2d6ef402a8311be460f983faa
TwelveData: Retrieved 100 OHLC records for AAPL
Successfully fetched 100 historical price points for AAPL
Momentum factor 1-month momentum: 0.630 (weight: 0.25)
Momentum factor 3-month momentum: 0.793 (weight: 0.3)
Momentum factor 6-month momentum: No data available
Momentum factor RSI: No data available
Momentum factor MACD: No data available
Momentum composite score for AAPL: 0.719 (based on 0.55 total weight)
‚úÖ Factor momentum_composite for AAPL: 0.7188 (calculated in 135ms)
Starting calculation of factor value_composite for AAPL
Calculating value composite for data: {
  peRatio: undefined,
  pbRatio: undefined,
  priceToSales: undefined,
  evEbitda: undefined,
  marketCap: 0
}
Value factor P/E Ratio: No valid data (null)
Value factor P/B Ratio: No valid data (null)
Value factor P/S Ratio: No valid data (null)
Value factor EV/EBITDA: No valid data (null)
Insufficient value factors: only 0 valid factors found
‚ö†Ô∏è Factor value_composite for AAPL: returned null/NaN (0ms)
Starting calculation of factor volatility_30d for AAPL
Calculating 30-day volatility for AAPL
Calculated 29 daily returns for AAPL
AAPL volatility stats: {
  periods: 29,
  dailyVol: '0.0160',
  annualizedVol: '0.2542',
  meanReturn: '0.0035'
}
AAPL volatility score: 0.746 (lower volatility = higher score)
‚úÖ Factor volatility_30d for AAPL: 0.7458 (calculated in 0ms)
‚úÖ Sentiment score for AAPL: 0.499 - TRACKED
Starting calculation of factor vwap_deviation_score for AAPL
üìä Calculating VWAP deviation score from pre-fetched data...
‚úÖ Factor vwap_deviation_score for AAPL: 0.3000 (calculated in 0ms)
‚úÖ VWAP deviation score for AAPL: 0.300 - TRACKED
Starting calculation of factor vwap_trading_signals for AAPL
üìä Calculating VWAP trading signals from pre-fetched data...
üìä VWAP trading signal: above with weak strength = 0.560
‚úÖ Factor vwap_trading_signals for AAPL: 0.5600 (calculated in 0ms)
‚úÖ VWAP trading signals for AAPL: 0.560 - TRACKED
Starting calculation of factor vwap_trend_analysis for AAPL
üìä Calculating VWAP trend score with historical analysis...
üìä No VWAP trend insights available for AAPL - using fallback
üìä Calculating VWAP trading signals from pre-fetched data...
üìä VWAP trading signal: above with weak strength = 0.560
‚úÖ Factor vwap_trend_analysis for AAPL: 0.5600 (calculated in 101ms)
‚úÖ VWAP trend analysis for AAPL: 0.560 - TRACKED
Starting calculation of factor macroeconomic_sector_impact for AAPL
üåç Calculating macroeconomic sector impact from pre-fetched data...
üåç Macro sector impact for Technology: positive = 0.900
‚úÖ Factor macroeconomic_sector_impact for AAPL: 0.9000 (calculated in 0ms)
‚úÖ Macro sector impact for AAPL: 0.900 - TRACKED
Starting calculation of factor macroeconomic_composite for AAPL
üåç Calculating macroeconomic composite from pre-fetched data...
üåç Macroeconomic composite score: 1.000 (confidence: 1)
‚úÖ Factor macroeconomic_composite for AAPL: 1.0000 (calculated in 0ms)
‚úÖ Macroeconomic composite for AAPL: 1.000 - TRACKED
Starting calculation of factor esg_composite for AAPL
üå± Analyzing ESG impact for AAPL (Technology)
‚úÖ Factor esg_composite for AAPL: 0.8100 (calculated in 1ms)
‚úÖ ESG composite score for AAPL: 0.810 - TRACKED
Starting calculation of factor short_interest_composite for AAPL
üìä Using pre-fetched short interest data for AAPL: score 0.49874999999999997
‚úÖ Factor short_interest_composite for AAPL: 0.4987 (calculated in 0ms)
‚úÖ Short interest composite for AAPL: 0.499 - TRACKED
Starting calculation of factor extended_market_composite for AAPL
üíπ Using pre-fetched extended market data for AAPL: status market-hours
‚úÖ Factor extended_market_composite for AAPL: 0.5900 (calculated in 0ms)
‚úÖ Extended market composite for AAPL: 0.590 - TRACKED
Successfully calculated score for AAPL: 0.6252326977777778
Calculated scores for 1 stocks
Selected 1 stocks after applying criteria
üîç Getting stock price for AAPL using smart fallback chain...
[2025-09-26T15:01:42.039Z] DEBUG [FallbackDataService] Starting API call: getFundamentalRatios
Metadata: {
  "timeout": 30000,
  "retries": 2
}
[2025-09-26T15:01:42.039Z] DEBUG [FallbackDataService] Starting API call: Financial Modeling Prep_getFundamentalRatios
Metadata: {
  "timeout": 20000,
  "retries": 1
}
[2025-09-26T15:01:42.040Z] DEBUG [api.financial-modeling-prep] Starting API call: getFundamentalRatios
Metadata: {
  "timeout": 15000,
  "retries": 2
}
[2025-09-26T15:01:42.041Z] DEBUG [FallbackDataService] Starting API call: Yahoo Finance_getFundamentalRatios
Metadata: {
  "timeout": 20000,
  "retries": 1
}
üìä Fetching fundamental data from yfinance for AAPL
[2025-09-26T15:01:42.048Z] DEBUG [FallbackDataService] Starting API call: getStockPrice
Metadata: {
  "timeout": 30000,
  "retries": 2
}
[2025-09-26T15:01:42.048Z] DEBUG [FallbackDataService] Optimal source selection for stock_price
Metadata: {
  "selectedSources": [
    {
      "name": "Twelve Data",
      "priority": 5,
      "rateLimit": 8,
      "currentUsage": 0
    },
    {
      "name": "Alpha Vantage",
      "priority": 4,
      "rateLimit": 5,
      "currentUsage": 0
    },
    {
      "name": "Yahoo Finance",
      "priority": 3,
      "rateLimit": 60,
      "currentUsage": 0
    }
  ],
  "totalAvailable": 5
}
[2025-09-26T15:01:42.048Z] DEBUG [FallbackDataService] Trying Twelve Data for AAPL
[2025-09-26T15:01:42.048Z] DEBUG [FallbackDataService] Starting API call: Twelve Data_getStockPrice
Metadata: {
  "timeout": 15000,
  "retries": 1
}
üåê TwelveData API URL: https://api.twelvedata.com/quote?symbol=AAPL&apikey=d9cb9bb2d6ef402a8311be460f983faa
[2025-09-26T15:01:42.080Z] WARN [api.financial-modeling-prep] Invalid ratios response structure
Metadata: {
  "errors": [
    "Invalid response data structure"
  ],
  "symbol": "AAPL"
}
[2025-09-26T15:01:42.080Z] WARN [api.financial-modeling-prep] Invalid metrics response structure
Metadata: {
  "errors": [
    "Invalid response data structure"
  ],
  "symbol": "AAPL"
}
[2025-09-26T15:01:42.080Z] WARN [api.financial-modeling-prep] Invalid pbRatio value for AAPL
Metadata: {
  "fieldName": "pbRatio",
  "value": 57.71331068524989,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T15:01:42.080Z] WARN [api.financial-modeling-prep] Invalid priceToSales value for AAPL
Metadata: {
  "fieldName": "priceToSales",
  "value": 9.258696420067299,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T15:01:42.080Z] WARN [api.financial-modeling-prep] Invalid currentRatio value for AAPL
Metadata: {
  "fieldName": "currentRatio",
  "value": 0.8679917800453515,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T15:01:42.080Z] WARN [api.financial-modeling-prep] Invalid quickRatio value for AAPL
Metadata: {
  "fieldName": "quickRatio",
  "value": 0.8260062358276644,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T15:01:42.080Z] WARN [api.financial-modeling-prep] Invalid grossProfitMargin value for AAPL
Metadata: {
  "fieldName": "grossProfitMargin",
  "value": 0.4667825022942796,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T15:01:42.080Z] WARN [api.financial-modeling-prep] Invalid operatingMargin value for AAPL
Metadata: {
  "fieldName": "operatingMargin",
  "value": 0.31866381156316914,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T15:01:42.080Z] WARN [api.financial-modeling-prep] Invalid netProfitMargin value for AAPL
Metadata: {
  "fieldName": "netProfitMargin",
  "value": 0.24296115019883757,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T15:01:42.080Z] WARN [api.financial-modeling-prep] Invalid dividendYield value for AAPL
Metadata: {
  "fieldName": "dividendYield",
  "value": 0.00400102,
  "errors": [
    "Too many decimal places - maximum 6 allowed"
  ]
}
[2025-09-26T15:01:42.080Z] DEBUG [api.financial-modeling-prep] Performance: getFundamentalRatios completed in 40ms
Metadata: {
  "type": "performance",
  "operation": "getFundamentalRatios",
  "duration": 40,
  "attempts": 1
}
[2025-09-26T15:01:42.080Z] DEBUG [FallbackDataService] Performance: Financial Modeling Prep_getFundamentalRatios completed in 41ms
Metadata: {
  "type": "performance",
  "operation": "Financial Modeling Prep_getFundamentalRatios",
  "duration": 41,
  "attempts": 1
}
[2025-09-26T15:01:42.080Z] INFO [FallbackDataService] Fundamental ratios from Financial Modeling Prep for AAPL
Metadata: {
  "peRatio": "N/A",
  "pbRatio": "N/A",
  "source": "Financial Modeling Prep"
}
üéØ Price targets from Financial Modeling Prep for AAPL: $241.26 (-5.4% upside)
[2025-09-26T15:01:42.177Z] DEBUG [FallbackDataService] Performance: Twelve Data_getStockPrice completed in 129ms
Metadata: {
  "type": "performance",
  "operation": "Twelve Data_getStockPrice",
  "duration": 129,
  "attempts": 1
}
[2025-09-26T15:01:42.178Z] DEBUG [FallbackDataService] Performance: Twelve Data_getStockPrice completed in 130ms
Metadata: {
  "type": "performance",
  "operation": "Twelve Data_getStockPrice",
  "duration": 130,
  "symbol": "AAPL",
  "source": "Twelve Data"
}
[2025-09-26T15:01:42.178Z] DEBUG [FallbackDataService] Performance: getStockPrice completed in 130ms
Metadata: {
  "type": "performance",
  "operation": "getStockPrice",
  "duration": 130,
  "attempts": 1
}
‚úÖ Got AAPL price: $255.03 from twelve_data
[2025-09-26T15:01:42.202Z] INFO [api.financial-modeling-prep] Generated synthetic analyst ratings for AAPL from price targets
Metadata: {
  "consensus": "Sell",
  "totalAnalysts": 8,
  "sentimentScore": 2
}
üìä Analyst ratings from Financial Modeling Prep for AAPL: Sell (8 analysts)
‚úÖ yfinance fundamental data retrieved for AAPL: { peRatio: '38.63', roe: '149.81%', debtToEquity: '154.49' }
[2025-09-26T15:01:43.238Z] DEBUG [FallbackDataService] Performance: Yahoo Finance_getFundamentalRatios completed in 1197ms
Metadata: {
  "type": "performance",
  "operation": "Yahoo Finance_getFundamentalRatios",
  "duration": 1197,
  "attempts": 1
}
[2025-09-26T15:01:43.238Z] INFO [FallbackDataService] Fundamental ratios from Yahoo Finance for AAPL
Metadata: {
  "peRatio": "38.63",
  "pbRatio": "57.53",
  "source": "Yahoo Finance"
}
[2025-09-26T15:01:43.238Z] DEBUG [FallbackDataService] Performance: getFundamentalRatios completed in 1199ms
Metadata: {
  "type": "performance",
  "operation": "getFundamentalRatios",
  "duration": 1199,
  "attempts": 1
}
[2025-09-26T15:01:43.238Z] DEBUG [FMPCacheManager] Cache entry set for fmp:fundamental_ratios:AAPL
Metadata: {
  "dataType": "fundamental_ratios",
  "ttl": "3600s",
  "compressed": false,
  "size": "0.1KB"
}
[2025-09-26T15:01:43.238Z] DEBUG [FallbackDataService] Cached fundamental ratios for AAPL
Enhanced factors for utilization: [macroeconomic_composite, fundamentalData, fundamentals, macroeconomic_sector_impact, esg_composite]
Primary factors extracted for AAPL: [
  'macroeconomic_composite',
  'fundamentalData',
  'fundamentals',
  'macroeconomic_sector_impact',
  'esg_composite'
]
üìä Returning cached macro context (1ms)
üì∞ Analyzing sentiment impact for AAPL (Technology)
üå± Analyzing ESG impact for AAPL (Technology)
üìä Analyzing short interest impact for AAPL (Technology)
üìä Short interest data for AAPL retrieved from cache
üîç Service utilization for technicalAnalysis: 1/1 = 100%
üîç Service utilization for fundamentals: 1/1 = 100%
üîç Service utilization for macroeconomicAnalysis: 1/1 = 100%
üîç Service utilization for sentimentAnalysis: 1/1 = 100%
üîç Service utilization for vwapAnalysis: 1/1 = 100%
üîç Service utilization for esgAnalysis: 1/1 = 100%
üîç Service utilization for shortInterestAnalysis: 1/1 = 100%
Actual cache hit rate: 0/0 = 0.0%
‚úÖ Comprehensive analysis completed in 21674ms { success: true, topSelections: 1, analysisInputServices: 10 }
 POST /api/stocks/analyze 200 in 21901ms
[?25h
